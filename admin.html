<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Admin ‚Äì Eierh√ºtten hinzuf√ºgen</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEKf0hPfUQKPoIw4xNLswITPnXUAMVFOo&libraries=places"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }

    #map {
      width: 100%;
      height: 300px;
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    input, button {
      padding: 8px;
      margin: 5px 0;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Adminbereich: Neue Eierh√ºtte hinzuf√ºgen</h1>

  <input id="placesSearch" type="text" placeholder="Eierh√ºtte suchen, z.‚ÄØB. Twist Eierh√ºtte" size="40" />
  <button onclick="clearSelection()">Zur√ºcksetzen</button>

  <div id="map"></div>

  <div id="info" style="margin-top: 20px;"></div>
  <button onclick="saveHuette()">‚úÖ Als Eierh√ºtte speichern</button>

  <script>
    let map;
    let marker = null;
    let selectedPlace = null;

    const huetten = []; // ‚Üê Du kannst sp√§ter hier Firebase integrieren

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 51.5, lng: 10.5 },
        zoom: 7
      });

      const input = document.getElementById("placesSearch");
      const autocomplete = new google.maps.places.Autocomplete(input);
      autocomplete.bindTo("bounds", map);

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.location) {
          alert("Ort nicht gefunden.");
          return;
        }

        map.setCenter(place.geometry.location);
        map.setZoom(14);

        if (marker) marker.setMap(null);

        marker = new google.maps.Marker({
          map,
          position: place.geometry.location,
          title: place.name
        });

        selectedPlace = place;

        document.getElementById("info").innerHTML = `
          <b>${place.name}</b><br>
          ${place.formatted_address}<br>
          üìç Lat: ${place.geometry.location.lat().toFixed(5)}<br>
          üìç Lng: ${place.geometry.location.lng().toFixed(5)}
        `;
      });
    }

    function clearSelection() {
      document.getElementById("placesSearch").value = "";
      document.getElementById("info").innerHTML = "";
      if (marker) marker.setMap(null);
      selectedPlace = null;
    }

    function saveHuette() {
      if (!selectedPlace) {
        alert("Bitte w√§hle zuerst einen Ort.");
        return;
      }

      const neueHuette = {
        id: Date.now(), // einfach eindeutige ID erzeugen
        name: selectedPlace.name,
        desc: selectedPlace.formatted_address || "Adresse unbekannt",
        lat: selectedPlace.geometry.location.lat(),
        lng: selectedPlace.geometry.location.lng(),
        strom: false // sp√§ter ggf. ausw√§hlbar
      };

      huetten.push(neueHuette);
      alert("‚úÖ Eierh√ºtte gespeichert (lokal im Speicher ‚Äì Firebase folgt).");
      console.log("Neue H√ºtte:", neueHuette);
      clearSelection();
    }

    window.onload = initMap;
  </script>
</body>
</html>
