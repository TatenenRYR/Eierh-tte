<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eierh√ºtten Assistent Chat</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #f3f4f6; font-family: Arial, sans-serif; }
    #chat-window { height: 500px; overflow-y: auto; padding: 1rem; background: #fff; border-radius: 0.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .message { clear: both; margin-bottom: 1rem; max-width: 75%; padding: 0.75rem 1rem; border-radius: 1rem; }
    .bot { float: left; background: #e0f2fe; color: #0369a1; }
    .user { float: right; background: #dcfce7; color: #166534; text-align: right; }
    #input-area { margin-top: 1rem; display: flex; gap: 0.5rem; }
    #chat-input { flex-grow: 1; padding: 0.5rem 1rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; }
    #send-btn { background: #0284c7; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; }
    #send-btn:hover { background: #0369a1; }
    button.choice-btn { background: #e0f2fe; border: 1px solid #0284c7; color: #0369a1; padding: 0.3rem 0.7rem; border-radius: 0.5rem; cursor: pointer; margin-right: 0.5rem; }
    button.choice-btn:hover { background: #bae6fd; }
    .hidden { display: none; }
    #map, .preview-map { width: 100%; height: 300px; margin-top: 1rem; border-radius: 0.5rem; }
  </style>
</head>
<body class="p-6"><!-- ... bisheriger HTML-Body unver√§ndert ... --><script>
// ... bestehender JS-Code ...

function showMyHuts() {
  addMessage('üìã Deine eingereichten H√ºtten:', 'bot');
  db.collection('eierhuetten').where('userId', '==', currentUser.uid).orderBy('erstelltAm', 'desc').get().then(snapshot => {
    if (snapshot.empty) {
      addMessage('Du hast noch keine H√ºtten eingereicht.', 'bot');
    } else {
      snapshot.forEach(doc => {
        const h = doc.data();
        const id = doc.id;
        const card = document.createElement('div');
        card.className = 'message bot';
        const coords = h.location ? `${h.location.latitude.toFixed(5)}, ${h.location.longitude.toFixed(5)}` : '-';
        card.innerHTML = `
          <div class="p-3 border border-blue-300 rounded bg-blue-50 shadow text-sm">
            <div><strong>üìç Name:</strong> ${h.name || '-'}</div>
            <div><strong>ü™ë Sitzpl√§tze:</strong> ${h.sitzplaetze || '-'}</div>
            <div><strong>üîå Strom:</strong> ${h.strom || '-'}</div>
            <div><strong>‚ú® Extras:</strong> ${h.extras || '-'}</div>
            <div><strong>üìå Koordinaten:</strong> ${coords}</div>
            <div><strong>üìÑ Status:</strong> ${h.status || 'offen'}</div>
            <div id="map_${id}" class="preview-map"></div>
          </div>`;
        chatWindow.appendChild(card);

        if (h.location) {
          setTimeout(() => {
            const m = L.map(`map_${id}`, { zoomControl: false, dragging: false, scrollWheelZoom: false });
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(m);
            m.setView([h.location.latitude, h.location.longitude], 15);
            L.marker([h.location.latitude, h.location.longitude]).addTo(m);
          }, 300);
        }
      });
    }
  });
}

// erweitere handleIntent um "meine h√ºtten"
function handleIntent(input) {
  const txt = input.toLowerCase();
  if (txt.includes('neu')) {
    step = 1; formData = {}; chatWindow.innerHTML = '';
    addMessage('üÜï Wie soll deine Eierh√ºtte hei√üen?', 'bot');
  } else if (txt.includes('meine')) {
    chatWindow.innerHTML = '';
    showMyHuts();
  } else {
    addMessage('ü§ñ Was m√∂chtest du tun?', 'bot');
    addChoiceButtons(['Neue H√ºtte einreichen', 'Meine H√ºtten ansehen'], handleIntent);
  }
}
</script></body>
</html>
