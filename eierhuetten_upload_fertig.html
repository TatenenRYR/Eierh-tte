<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eierhütten-Eintrag</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; color: #333; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    input, textarea, select, button { width: 100%; padding: 0.5rem; margin-top: 0.2rem; border-radius: 5px; border: 1px solid #ccc; }
    #debugConsole { background:#111; color:#0f0; padding:0.5rem; font-size:0.8rem; overflow:auto; max-height:150px; border-radius:6px; margin-top:1rem; }
    #summary { margin-top: 1rem; padding: 1rem; background: #fff5d1; border: 1px solid #ffd42a; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>🪺 Eierhütte einreichen</h1><label>📍 Ort</label> <input id="ort" placeholder="z. B. Meisenstraße 12, Dorf" />

<label>🪑 Sitzplatz vorhanden?</label> <select id="sitzplatz"> <option value="ja">Ja</option> <option value="nein">Nein</option> </select>

<label>🔌 Stromversorgung für E-Bikes?</label> <select id="strom"> <option value="ja">Ja</option> <option value="nein">Nein</option> </select>

<label>📋 Weitere Infos</label>

  <textarea id="zusatz" rows="3" placeholder="Besonderheiten, Öffnungszeiten etc."></textarea><label>🔑 OpenRouter API-Key</label> <input id="apiKeyInput" placeholder="org-..." oninput="saveApiKey()" />

<button onclick="beschreibungErstellen()">🧠 Beschreibung automatisch erstellen</button>

  <div id="summary"></div><button onclick="toggleDebug()">🛠️ Debug an/aus</button> <button onclick="clearDebug()">🧹 Debug löschen</button>

  <pre id="debugConsole"></pre><script>
let debugMode = true;

function debug(msg, data) {
  if (!debugMode) return;
  const line = `[DEBUG] ${msg}${data ? ': ' + JSON.stringify(data, null, 2) : ''}`;
  console.log(line);
  const el = document.getElementById("debugConsole");
  if (el) el.textContent += line + "\n";
}
function clearDebug() {
  document.getElementById("debugConsole").textContent = "";
  console.clear();
}
function toggleDebug() {
  debugMode = !debugMode;
  debug("Debug-Modus: " + (debugMode ? "aktiv" : "inaktiv"));
}

function saveApiKey() {
  const key = document.getElementById("apiKeyInput").value.trim();
  if (key) localStorage.setItem("openrouter_api_key", key);
}
function getApiKey() {
  return localStorage.getItem("openrouter_api_key") || "";
}

document.addEventListener("DOMContentLoaded", () => {
  const saved = getApiKey();
  if (saved) document.getElementById("apiKeyInput").value = saved;
});

async function beschreibungErstellen() {
  const ort = document.getElementById("ort").value.trim();
  const sitz = document.getElementById("sitzplatz").value;
  const strom = document.getElementById("strom").value;
  const zusatz = document.getElementById("zusatz").value.trim();
  const key = getApiKey();

  if (!key) return alert("Bitte OpenRouter API-Key eingeben.");

  const prompt = `Erstelle eine freundliche, vollständige Beschreibung einer Eierhütte. Ort: ${ort}. Sitzplatz: ${sitz}. Strom: ${strom}. Zusatzinfos: ${zusatz}`;

  try {
    debug("Sende Anfrage an OpenRouter", { prompt });
    const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${key}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "openchat/openchat-7b",
        messages: [
          { role: "system", content: "Du bist ein freundlicher Beschreibungshelfer für eine Fahrradtour-App mit Eierhütten." },
          { role: "user", content: prompt }
        ]
      })
    });
    const data = await res.json();
    debug("Antwort erhalten", data);
    const beschreibung = data.choices?.[0]?.message?.content;
    document.getElementById("summary").textContent = beschreibung || "❌ Keine Beschreibung erhalten.";
  } catch (err) {
    debug("Fehler bei Anfrage", err);
    alert("Fehler bei der Beschreibung: " + err.message);
  }
}
</script></body>
</html>
