<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard – Eierhütten</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="flex flex-col min-h-screen">
    <header class="bg-green-700 text-white p-4 shadow">
      <h1 class="text-2xl font-bold">Eierhütten Admin Dashboard</h1>
    </header><main class="flex flex-1">
  <aside class="w-64 bg-white p-4 border-r">
    <nav class="space-y-4">
      <button onclick="showTab('open')" class="w-full text-left font-medium">Offene Anfragen</button>
      <button onclick="showTab('archiv')" class="w-full text-left font-medium">Archivierte Anfragen</button>
      <button onclick="showTab('heatmap')" class="w-full text-left font-medium">Heatmap</button>
      <button onclick="showTab('zahlung')" class="w-full text-left font-medium">Zahlungshistorie</button>
    </nav>
  </aside>

  <section class="flex-1 p-6 overflow-auto">
    <div id="tab-open" class="tab">
      <h2 class="text-xl font-semibold mb-4">Offene Anfragen</h2>
      <div id="openList" class="grid gap-4"></div>
    </div>

    <div id="tab-archiv" class="tab hidden">
      <h2 class="text-xl font-semibold mb-4">Archivierte Anfragen</h2>
      <div id="archivList" class="grid gap-4"></div>
    </div>

    <div id="tab-heatmap" class="tab hidden">
      <h2 class="text-xl font-semibold mb-4">Heatmap</h2>
      <div id="heatmap" class="h-[500px] w-full"></div>
    </div>

    <div id="tab-zahlung" class="tab hidden">
      <h2 class="text-xl font-semibold mb-4">Zahlungshistorie</h2>
      <div id="zahlungList" class="grid gap-4"></div>
    </div>
  </section>
</main>

  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
      authDomain: "eierhuettentour.firebaseapp.com",
      projectId: "eierhuettentour",
      storageBucket: "eierhuettentour.firebasestorage.app",
      messagingSenderId: "348272135205",
      appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc",
      measurementId: "G-16V6K5GXDT"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const showTab = (id) => {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(`tab-${id}`).classList.remove('hidden');
    };

    const loadOpen = async () => {
      const querySnapshot = await db.collection("eierhuetten").where("status", "==", "offen").get();
      const container = document.getElementById("openList");
      container.innerHTML = "";
      querySnapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded shadow";
        card.innerHTML = `
          <p><strong>${data.name}</strong></p>
          <p>${data.beschreibung}</p>
          <p>Strom: ${data.strom}</p>
          <button class="mt-2 bg-green-500 text-white px-3 py-1 rounded" onclick="activateHut('${doc.id}')">Freigeben</button>
          <button class="mt-2 ml-2 bg-red-500 text-white px-3 py-1 rounded" onclick="archiveHut('${doc.id}')">Ablehnen</button>
        `;
        container.appendChild(card);
      });
    };

    const loadArchiv = async () => {
      const querySnapshot = await db.collection("eierhuetten").where("status", "==", "abgelehnt").get();
      const container = document.getElementById("archivList");
      container.innerHTML = "";
      querySnapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded shadow";
        card.innerHTML = `
          <p><strong>${data.name}</strong></p>
          <p>${data.beschreibung}</p>
        `;
        container.appendChild(card);
      });
    };

    const loadZahlung = async () => {
      const querySnapshot = await db.collection("zahlungen").orderBy("datum", "desc").limit(50).get();
      const container = document.getElementById("zahlungList");
      container.innerHTML = "";
      querySnapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded shadow";
        card.innerHTML = `
          <p><strong>${data.huettenName}</strong> – ${data.betrag} €</p>
          <p>${new Date(data.datum).toLocaleDateString()}</p>
        `;
        container.appendChild(card);
      });
    };

    const activateHut = async (id) => {
      await db.collection("eierhuetten").doc(id).update({ status: "aktiviert" });
      loadOpen();
    };

    const archiveHut = async (id) => {
      await db.collection("eierhuetten").doc(id).update({ status: "abgelehnt" });
      loadOpen();
    };

    const loadHeatmap = async () => {
      const map = L.map('heatmap').setView([52.6, 7.1], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      const querySnapshot = await db.collection("eierhuetten").get();
      querySnapshot.forEach(doc => {
        const d = doc.data();
        if (d.location?.latitude && d.location?.longitude) {
          L.circle([d.location.latitude, d.location.longitude], {
            radius: 300,
            color: d.status === 'aktiviert' ? 'green' : d.status === 'abgelehnt' ? 'red' : 'orange'
          }).addTo(map);
        }
      });
    };

    showTab('open');
    loadOpen();
    loadArchiv();
    loadZahlung();
    loadHeatmap();
  </script></body>
</html>
