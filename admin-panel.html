<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eierhütten Admin Dashboard</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 flex flex-col min-h-screen">  <!-- Header -->  <header class="bg-green-600 text-white p-4 shadow flex justify-between items-center">
    <h1 class="text-xl font-bold">Eierhütten Admin</h1>
    <button id="loginBtn" class="bg-white text-green-600 px-3 py-1 rounded">Login</button>
  </header>  <!-- Main Content -->  <main class="flex-1 overflow-auto p-4 pb-24">
    <!-- Tabs -->
    <div class="grid grid-cols-2 gap-2 md:grid-cols-4 mb-4">
      <button data-tab="active" class="tab-btn bg-white p-2 rounded shadow">Aktive</button>
      <button data-tab="archived" class="tab-btn bg-white p-2 rounded shadow">Archiv</button>
      <button data-tab="heatmap" class="tab-btn bg-white p-2 rounded shadow">Heatmap</button>
      <button data-tab="payments" class="tab-btn bg-white p-2 rounded shadow">Zahlungen</button>
    </div><!-- Sections -->
<section id="tab-active" class="tab-content">
  <h2 class="text-lg font-semibold mb-2">Offene Anfragen</h2>
  <div id="activeList" class="space-y-4"></div>
</section>

<section id="tab-archived" class="tab-content hidden">
  <h2 class="text-lg font-semibold mb-2">Archivierte Anfragen</h2>
  <div id="archivedList" class="space-y-4"></div>
</section>

<section id="tab-heatmap" class="tab-content hidden">
  <h2 class="text-lg font-semibold mb-2">Heatmap</h2>
  <div id="heatmap" class="h-80 rounded shadow"></div>
</section>

<section id="tab-payments" class="tab-content hidden">
  <h2 class="text-lg font-semibold mb-2">Zahlungshistorie</h2>
  <div id="paymentList" class="space-y-2"></div>
</section>

  </main>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
      authDomain: "eierhuettentour.firebaseapp.com",
      projectId: "eierhuettentour",
      storageBucket: "eierhuettentour.firebasestorage.app",
      messagingSenderId: "348272135205",
      appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc",
      measurementId: "G-16V6K5GXDT"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.getElementById('loginBtn').onclick = async () => {
      try {
        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        document.getElementById('loginBtn').classList.add('hidden');
        showTab('active');
        loadAll();
      } catch (e) {
        alert('Login fehlgeschlagen: ' + e.message);
      }
    };

    document.querySelectorAll('.tab-btn').forEach(btn => btn.onclick = () => showTab(btn.dataset.tab));

    function showTab(tab) {
      document.querySelectorAll('.tab-content').forEach(s => s.classList.add('hidden'));
      document.getElementById('tab-' + tab).classList.remove('hidden');
    }

    async function loadAll() {
      await loadActive();
      await loadArchived();
      await loadHeatmap();
      await loadPayments();
    }

    async function loadActive() {
      const list = document.getElementById('activeList');
      list.innerHTML = '';
      const snap = await db.collection('eierhuetten').where('status','==','offen').get();
      snap.forEach(doc => {
        const d = doc.data();
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded shadow';
        card.innerHTML = `
          <p class="font-bold">${d.name}</p>
          <p>${d.beschreibung || ''}</p>
          <div class="flex space-x-2 mt-2">
            <button class="bg-green-500 text-white px-3 py-1 rounded" onclick="updateStatus('${doc.id}','aktiviert')">Freigeben</button>
            <button class="bg-red-500 text-white px-3 py-1 rounded" onclick="updateStatus('${doc.id}','abgelehnt')">Ablehnen</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    async function loadArchived() {
      const list = document.getElementById('archivedList');
      list.innerHTML = '';
      const snap = await db.collection('eierhuetten').where('status','==','abgelehnt').get();
      snap.forEach(doc => {
        const d = doc.data();
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded shadow';
        card.innerHTML = `<p class="font-bold">${d.name}</p><p>${d.beschreibung || ''}</p>`;
        list.appendChild(card);
      });
    }

    async function updateStatus(id, status) {
      await db.collection('eierhuetten').doc(id).update({ status });
      loadAll();
    }

    async function loadHeatmap() {
      const map = L.map('heatmap').setView([52.67, 7.17], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      const snap = await db.collection('eierhuetten').get();
      const points = snap.docs.map(d=>d.data()).filter(d=>d.location).map(d=>[d.location.latitude, d.location.longitude, 1]);
      L.heatLayer(points,{radius:25}).addTo(map);
    }

    async function loadPayments() {
      const list = document.getElementById('paymentList');
      list.innerHTML = '';
      const snap = await db.collection('zahlungen').orderBy('datum','desc').limit(50).get();
      snap.forEach(doc => {
        const p = doc.data();
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded shadow';
        card.innerHTML = `
          <p><strong>${p.huettenName || 'Unbekannt'}</strong>: ${p.betrag || '0,00'} €</p>
          <p class="text-sm text-gray-600">${new Date(p.datum).toLocaleDateString()}</p>
        `;
        list.appendChild(card);
      });
    }
  </script></body>
</html>
