<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Neue Eierhütte einreichen</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; background: #f9f9f9; padding: 1rem; border-radius: 8px; }
  label { display: block; margin-top: 1rem; }
  input, button { padding: 0.5rem; width: 100%; margin-top: 0.25rem; }
  button { background-color: #2c7be5; color: white; border: none; border-radius: 5px; cursor: pointer; }
  .message { margin-top: 1rem; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD7pocrD9_46QNoz1jrxggpzkL7E6IhetY",
    authDomain: "einkaufliste-cd5d3.firebaseapp.com",
    projectId: "einkaufliste-cd5d3",
    storageBucket: "einkaufliste-cd5d3.firebasestorage.app",
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  async function einreichen(event) {
    event.preventDefault();

    const name = document.getElementById('name').value.trim();
    const strom = document.getElementById('strom').checked;
    const lat = parseFloat(document.getElementById('lat').value);
    const lng = parseFloat(document.getElementById('lng').value);
    const fotoFile = document.getElementById('foto').files[0];

    if (!name || isNaN(lat) || isNaN(lng)) {
      showMessage('Bitte alle Pflichtfelder korrekt ausfüllen.', true);
      return;
    }

    const kosten = 2.00;
    let fotoUrl = null;

    try {
      if (fotoFile) {
        const storageRef = storage.ref();
        const fotoRef = storageRef.child(`huetten_fotos/${Date.now()}_${fotoFile.name}`);
        const snapshot = await fotoRef.put(fotoFile);
        fotoUrl = await snapshot.ref.getDownloadURL();
      }

      await db.collection('huetten_pending').add({
        name,
        strom,
        lat,
        lng,
        status: 'offen',
        kosten,
        fotoUrl,
        eingereichtAm: new Date().toISOString(),
      });

      showMessage('Eierhütte erfolgreich eingereicht! Vielen Dank.');
      document.getElementById('einreichenForm').reset();

    } catch (error) {
      showMessage('Fehler beim Einreichen: ' + error.message, true);
    }
  }

  function showMessage(msg, isError = false) {
    const messageEl = document.getElementById('message');
    messageEl.innerText = msg;
    messageEl.style.color = isError ? 'red' : 'green';
  }
</script>
</head>
<body>

<h1>Neue Eierhütte einreichen</h1>

<form id="einreichenForm" onsubmit="einreichen(event)">
  <label for="name">Name der Hütte*</label>
  <input type="text" id="name" required />

  <label><input type="checkbox" id="strom" /> Strom vorhanden</label>

  <label for="lat">Latitude (z.B. 48.12345)*</label>
  <input type="number" step="0.00001" id="lat" required />

  <label for="lng">Longitude (z.B. 11.98765)*</label>
  <input type="number" step="0.00001" id="lng" required />

  <label for="foto">Foto (optional)</label>
  <input type="file" id="foto" accept="image/*" />

  <button type="submit">Hütte einreichen</button>
</form>

<p id="message" class="message"></p>

</body>
</html>
