<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stabile RadlMap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100%; }
    #followBtn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: #10b981;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      display: none;
      font-size: 1em;
    }
    #routeInfo {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 8px 12px;
      border-radius: 8px;
      z-index: 999;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="routeInfo">üö¥</div>
  <button id="followBtn" onclick="enableAutoFollow()">üìç Folgen</button>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([51.5, 10.5], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);let userMarker = null;
let autoFollow = true;
let firstUpdate = true;
let routeLayer = null;

function locateUser() {
  if (!navigator.geolocation) {
    alert('Geolocation wird nicht unterst√ºtzt');
    return;
  }

  navigator.geolocation.watchPosition(pos => {
    const latlng = [pos.coords.latitude, pos.coords.longitude];

    if (!userMarker) {
      userMarker = L.marker(latlng).addTo(map);
    } else {
      userMarker.setLatLng(latlng);
    }

    if (firstUpdate || autoFollow) {
      map.setView(latlng, 15);
      firstUpdate = false;
    }
  }, err => {
    alert("Fehler beim Standortzugriff");
  }, {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 10000
  });
}

function enableAutoFollow() {
  autoFollow = true;
  document.getElementById('followBtn').style.display = 'none';
  if (userMarker) {
    map.setView(userMarker.getLatLng(), 15);
  }
}

map.on('dragstart', () => {
  autoFollow = false;
  document.getElementById('followBtn').style.display = 'block';
});

async function calculateRoute() {
  const coordinates = [
    [10.0, 51.5],
    [10.1, 51.6],
    [10.3, 51.55]
  ];

  try {
    const response = await fetch('https://api.openrouteservice.org/v2/directions/cycling-regular/geojson', {
      method: 'POST',
      headers: {
        'Authorization': '5b3ce3597851110001cf624866907189b4974b88e5541b15dfed2e1603067f5b85cd6da44c68ee87',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ coordinates })
    });

    const data = await response.json();
    const routeCoords = data.features[0].geometry.coordinates.map(c => [c[1], c[0]]);

    if (routeLayer) map.removeLayer(routeLayer);
    routeLayer = L.polyline(routeCoords, {
      color: '#10b981',
      weight: 5,
      opacity: 0.9
    }).addTo(map);

    map.fitBounds(routeLayer.getBounds(), { padding: [40, 40] });

    const dist = data.features[0].properties.summary.distance / 1000;
    const dur = data.features[0].properties.summary.duration / 60;
    const h = Math.floor(dur / 60);
    const m = Math.round(dur % 60);
    const timeStr = h > 0 ? `${h} Std ${m} Min` : `${m} Min`;

    document.getElementById('routeInfo').innerText = `üö¥ ${dist.toFixed(1)} km ¬∑ ‚è± ${timeStr}`;
  } catch (err) {
    console.error("Routenfehler:", err);
    alert("Route konnte nicht geladen werden");
  }
}

locateUser();
calculateRoute();

  </script>
</body>
</html>
