<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eierh√ºtten-Tour</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 300px;
      height: 100%;
      background: white;
      box-shadow: 2px 0 5px rgba(0,0,0,0.3);
      padding: 1rem;
      overflow-y: auto;
      display: none;
    }
    #sidebar.open {
      display: block;
    }
    #menuButton {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: green;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .small-btn {
      padding: 2px 6px;
      margin-top: 5px;
      cursor: pointer;
    }
    .route-list li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <button id="menuButton">‚ò∞</button>
  <div id="sidebar">
    <h2>Tour</h2>
    <ul id="tourList" class="route-list"></ul>
    <button onclick="berechneRoute()">Route berechnen</button>
    <button onclick="zeigeNaechsteHuette()">N√§chste H√ºtte</button>
    <p id="distanz"></p>
  </div>
  <div id="map"></div>  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>  <script>
    let karte = L.map('map').setView([51.505, 10.5], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap-Mitwirkende'
    }).addTo(karte);

    let markerLayer = L.layerGroup().addTo(karte);
    let route = [];
    let routingLayer;

    document.getElementById("menuButton").onclick = () => {
      document.getElementById("sidebar").classList.toggle("open");
    };

    let huetten = JSON.parse(localStorage.getItem("huetten")) || [];

    function updateMapMarkers() {
      markerLayer.clearLayers();
      huetten.forEach(h => {
        if (filterAktiv && !h.strom) return;
        let marker = L.marker([h.lat, h.lng]);
        marker.bindPopup(`
          <b>${h.name}</b><br>
          ${h.desc}<br>
          ${h.strom ? "üîå Strom vorhanden" : "‚ùå Kein Strom"}<br><br>
          <button onclick="addToRoute(${h.id})" class="small-btn">‚ûï Hinzuf√ºgen</button>
        `);
        markerLayer.addLayer(marker);
      });
    }

    function addToRoute(id) {
      if (!route.includes(id)) {
        route.push(id);
        updateTourList();
      }
    }

    function updateTourList() {
      let list = document.getElementById("tourList");
      list.innerHTML = "";
      route.forEach(id => {
        let h = huetten.find(h => h.id === id);
        let li = document.createElement("li");
        li.textContent = h.name;
        list.appendChild(li);
      });
    }

    function berechneRoute() {
      if (routingLayer) karte.removeLayer(routingLayer);

      let punkte = route.map(id => {
        let h = huetten.find(h => h.id === id);
        return [h.lat, h.lng];
      });

      if (punkte.length < 2) return alert("Mindestens zwei Ziele w√§hlen.");

      routingLayer = L.polyline(punkte, { color: "blue" }).addTo(karte);

      let distanz = 0;
      for (let i = 1; i < punkte.length; i++) {
        distanz += karte.distance(punkte[i - 1], punkte[i]);
      }
      document.getElementById("distanz").innerText =
        "Gesamtdistanz: " + (distanz / 1000).toFixed(2) + " km";
    }

    let aktuellePosition = 0;
    function zeigeNaechsteHuette() {
      if (route.length == 0) return;
      let h = huetten.find(h => h.id === route[aktuellePosition]);
      karte.setView([h.lat, h.lng], 16);
      aktuellePosition = (aktuellePosition + 1) % route.length;
    }

    let filterAktiv = false;
    function toggleStromFilter() {
      filterAktiv = !filterAktiv;
      updateMapMarkers();
    }

    function toggleFavorit(id) {
      const h = huetten.find(h => h.id === id);
      if (h) {
        h.favorit = !h.favorit;
        localStorage.setItem("huetten", JSON.stringify(huetten));
        updateMapMarkers();
      }
    }

    updateMapMarkers();
  </script></body>
</html>
