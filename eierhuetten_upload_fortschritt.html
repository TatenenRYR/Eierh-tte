<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eierhütten-Setup</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Nunito', sans-serif;
      background-color: #1c1c1c;
      color: #fff;
    }
    #chat {
      max-width: 500px;
      margin: 0 auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }
    .bubble {
      max-width: 80%;
      padding: 1rem;
      margin: .5rem;
      border-radius: 1.2rem;
      position: relative;
      animation: fadeIn .4s ease forwards;
    }
    .bot {
      background-color: #2e2e2e;
      align-self: flex-start;
    }
    .user {
      background-color: #4caf50;
      align-self: flex-end;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    #map { width: 100%; height: 200px; border-radius: .5rem; margin: .5rem 0; }
    #input-area {
      display: flex;
      margin-top: 1rem;
    }
    #user-input {
      flex: 1;
      padding: .6rem;
      border: none;
      border-radius: .5rem;
      font-size: 1rem;
    }
    #send-btn {
      padding: .6rem 1rem;
      margin-left: .5rem;
      background: #4caf50;
      border: none;
      color: white;
      border-radius: .5rem;
      cursor: pointer;
    }
    #hut-face {
      width: 64px;
      height: 64px;
      margin-bottom: .5rem;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .typing {
      font-style: italic;
      color: #aaa;
      margin-left: .5rem;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: .3; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="chat">
    <img id="hut-face" src="https://cdn-icons-png.flaticon.com/512/135/135620.png" alt="Hütte">
    <div id="messages"></div>
    <div id="map"></div>
    <div id="input-area">
      <input id="user-input" placeholder="Deine Antwort..." />
      <button id="send-btn">Senden</button>
    </div>
  </div>  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
      authDomain: "eierhuettentour.firebaseapp.com",
      projectId: "eierhuettentour",
      storageBucket: "eierhuettentour.appspot.com",
      messagingSenderId: "348272135205",
      appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();let currentUser = null;
let currentStep = 0;
let hutData = {};

const messages = document.getElementById("messages");
const input = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");

const map = L.map('map').setView([51, 10], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

let marker = null;
map.on('click', e => {
  if (marker) marker.setLatLng(e.latlng);
  else marker = L.marker(e.latlng).addTo(map);
  hutData.lat = e.latlng.lat;
  hutData.lng = e.latlng.lng;
  botSay("Standort gespeichert: " + e.latlng.lat.toFixed(5) + ", " + e.latlng.lng.toFixed(5));
});

function botSay(msg, typing = false) {
  const div = document.createElement("div");
  div.className = "bubble bot";
  div.innerHTML = typing ? `<span class="typing">${msg}</span>` : msg;
  messages.appendChild(div);
  div.scrollIntoView();
}

function userSay(msg) {
  const div = document.createElement("div");
  div.className = "bubble user";
  div.textContent = msg;
  messages.appendChild(div);
  div.scrollIntoView();
}

function askNext() {
  const fragen = [
    "Wie soll deine Eierhütte heißen?",
    "Beschreibe sie in ein paar Worten:",
    "Hat die Hütte Strom? (ja/nein)",
    "Klicke auf die Karte, um den Standort auszuwählen."
  ];
  if (currentStep < fragen.length) botSay(fragen[currentStep], true);
  else saveData();
}

async function saveData() {
  if (!currentUser) return botSay("Du bist nicht eingeloggt.");
  try {
    await db.collection("eierhuetten").add({
      ...hutData,
      userId: currentUser.uid,
      erstelltAm: firebase.firestore.FieldValue.serverTimestamp(),
      status: "offen"
    });
    botSay("✅ Hütte gespeichert! Willst du eine weitere Hütte eintragen?");
    currentStep = 0;
    hutData = {};
  } catch (err) {
    botSay("❌ Fehler beim Speichern: " + err.message);
  }
}

sendBtn.onclick = () => {
  const msg = input.value.trim();
  if (!msg) return;
  userSay(msg);
  input.value = "";
  switch (currentStep) {
    case 0: hutData.name = msg; break;
    case 1: hutData.beschreibung = msg; break;
    case 2: hutData.strom = msg.toLowerCase().includes("ja"); break;
  }
  currentStep++;
  askNext();
};

auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    botSay("Hallo " + user.displayName + "! Willkommen zurück.");
    askNext();
  } else {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  }
});

  </script>
</body>
</html>
