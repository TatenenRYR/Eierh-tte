<!DOCTYPE html><html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Eierhütten Chat</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    margin: 0; padding: 0; background: #f0f2f5; color: #333;
    display: flex; flex-direction: column; height: 100vh;
  }
  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: 600px;
    margin: auto;
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  #messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    background: #e5e7eb;
  }
  #messages .message {
    margin-bottom: 0.75rem;
    padding: 0.75rem 1rem;
    border-radius: 12px;
    max-width: 75%;
    animation: fadeIn 0.3s ease;
  }
  #messages .message.user {
    background: #0b93f6; color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 0;
  }
  #messages .message.bot {
    background: #e1e8f0; color: #333;
    align-self: flex-start;
    border-bottom-left-radius: 0;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px);} to {opacity:1; transform: translateY(0); }
  }
  #input-form {
    display: flex;
    border-top: 1px solid #d1d5db;
    background: #fff;
  }
  #input-form input[type="text"] {
    flex: 1;
    border: none;
    padding: 1rem;
    font-size: 1rem;
    outline: none;
  }
  #input-form button {
    background: #0b93f6;
    border: none;
    color: #fff;
    padding: 0 1.5rem;
    cursor: pointer;
    font-weight: 600;
  }
  #input-form button:disabled {
    background: #7fbdfb;
    cursor: default;
  }
  #map {
    height: 300px;
    display: none;
  }
  /* Tipp-Buttons */
  #tips {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem;
    background: #f7fafc;
    border-bottom: 1px solid #d1d5db;
    flex-wrap: wrap;
  }
  #tips button {
    background: #0b93f6;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-size: 0.875rem;
  }
  #tips button:disabled {
    background: #a1c8f5;
    cursor: default;
  }
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
</head>
<body>
<div class="chat-container">
  <div id="tips"></div>
  <div id="messages"></div>
  <form id="input-form">
    <input type="text" id="input" autocomplete="off" placeholder="Nachricht eingeben..." />
    <button type="submit" id="send-btn" disabled>Senden</button>
  </form>
  <div id="map"></div>
</div>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  // Firebase config
  const firebaseConfig = { /* DEINE KONFIG HIER */ };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();const tipsEl = document.getElementById('tips'); const messagesEl = document.getElementById('messages'); const inputEl = document.getElementById('input'); const sendBtn = document.getElementById('send-btn'); const mapEl = document.getElementById('map');

let map = L.map(mapEl).setView([51.1657,10.4515],6); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution: '© OSM' }).addTo(map); let marker;

let currentUser=null, dialogState=null, hutData={}, selectedHutId=null;

function addMessage(text, sender='bot'){ const div=document.createElement('div'); div.className=message ${sender}; div.textContent=text; messagesEl.appendChild(div); messagesEl.scrollTop=messagesEl.scrollHeight; }

// Initialize tips const tipActions = [ null, () => startNewHut(), async ()=> await showMyHuts(), () => sendLocation() ]; const tipTexts=['','Neue Hütte erstellen','Meine Hütten anzeigen','Standort senden']; tipTexts.forEach((txt,i)=>{ if(i===0) return; const btn=document.createElement('button'); btn.textContent=txt; btn.onclick=tipActions[i]; tipsEl.appendChild(btn); });

function disableTips(){ tipsEl.querySelectorAll('button').forEach(b=>{ b.disabled=true; }); }

auth.onAuthStateChanged(user=>{ currentUser=user; if(user) addMessage(Willkommen zurück, ${user.email}); else addMessage('Bitte melde dich an.'); });

// Chat submission inputEl.addEventListener('input',()=> sendBtn.disabled = !inputEl.value.trim()); document.getElementById('input-form').addEventListener('submit',async e=>{ e.preventDefault(); const msg=inputEl.value.trim(); if(!msg) return; addMessage(msg,'user'); inputEl.value=''; sendBtn.disabled=true; if(!currentUser){ addMessage('Bitte anmelden.'); return; } if(dialogState==='awaiting_name'){ hutData.name=msg; dialogState='awaiting_location'; mapEl.style.display='block'; map.invalidateSize(); addMessage('Wähle Standort: Karte anklicken oder nutze Standort senden.'); return; } const cmd=msg.toLowerCase(); if(cmd.includes('neue hütte')) startNewHut(); else if(cmd.includes('zeige')&&cmd.includes('hütten')) await showMyHuts(); else if(cmd.includes('standort')) sendLocation(); else addMessage('Befehl nicht erkannt.'); });

function startNewHut(){ dialogState='awaiting_name'; hutData={userId:currentUser.uid,status:'offen', erstelltAm:firebase.firestore.FieldValue.serverTimestamp()}; addMessage('Wie soll die neue Hütte heißen?'); }

async function showMyHuts(){ const snap=await db.collection('eierhuetten').where('userId','==',currentUser.uid).get(); if(snap.empty) addMessage('Keine Hütten.'); else snap.forEach(d=>addMessage(🏠 ${d.data().name} (ID:${d.id}))); }

function sendLocation(){ if(!navigator.geolocation) return addMessage('Keine Geolocation.'); navigator.geolocation.getCurrentPosition(pos=>addMessage(📍 ${pos.coords.latitude.toFixed(5)},${pos.coords.longitude.toFixed(5)}),()=>addMessage('Fehler Standort.')); }

map.on('click',async e=>{ if(dialogState!=='awaiting_location') return addMessage('Zuerst Hütte anlegen.'); const loc={latitude:e.latlng.lat,longitude:e.latlng.lng}; if(marker) marker.remove(); marker=L.marker([loc.latitude,loc.longitude]).addTo(map); hutData.location=new firebase.firestore.GeoPoint(loc.latitude,loc.longitude); await db.collection('eierhuetten').add(hutData); addMessage('✅ Hütte eingetragen'); dialogState=null; mapEl.style.display='none'; disableTips(); }); </script>

</body>
</html>
