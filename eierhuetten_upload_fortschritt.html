<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intelligenter Chatbot</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #121212;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .chat-container {
      width: 100%;
      max-width: 600px;
      height: 90vh;
      background: #1e1e1e;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    #messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .message {
      max-width: 75%;
      padding: 0.75rem 1rem;
      border-radius: 15px;
      opacity: 0;
      animation: fadeIn 0.3s forwards;
      position: relative;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .bot {
      background: #2c7a7b;
      align-self: flex-start;
      border-bottom-left-radius: 0;
    }
    .user {
      background: #4a5568;
      align-self: flex-end;
      border-bottom-right-radius: 0;
    }
    #input-area {
      display: flex;
      padding: 0.5rem;
      background: #2d2d2d;
    }
    #chat-input {
      flex: 1;
      padding: 0.75rem 1rem;
      border-radius: 20px;
      border: none;
      font-size: 1rem;
      outline: none;
    }
    #send-btn {
      margin-left: 0.5rem;
      padding: 0 1.2rem;
      border: none;
      border-radius: 20px;
      background: #285e61;
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
    }
    #send-btn:disabled { background: #444; cursor: not-allowed; }
    .tip {
      background: #1f4040;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      animation: fadeIn 0.5s forwards;
    }
    #location-options {
      display: flex;
      gap: 0.5rem;
      margin: 0.5rem 0;
    }
    .loc-btn {
      flex: 1;
      padding: 0.5rem;
      background: #285e61;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #map { height: 250px; border-radius: 10px; margin-top: 0.5rem; }
    @media (max-width: 480px) {
      .chat-container { height: 100vh; border-radius: 0; }
      #map { height: 200px; }
    }
  </style>
</head>
<body>
<div class="chat-container">
  <div id="messages"></div>
  <div id="input-area">
    <input type="text" id="chat-input" placeholder="Nachricht eingeben..." autocomplete="off" />
    <button id="send-btn" disabled>Senden</button>
  </div>
  <div id="map" style="display:none;"></div>
</div><script src="https://unpkg.com/leaflet/dist/leaflet.js"></script><script>
  const messagesEl = document.getElementById('messages');
  const inputEl = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');
  const mapEl = document.getElementById('map');
  let map, marker;
  let state = 'start';
  let tempData = {};

  // Utility to add messages
  function addMessage(text, sender = 'bot') {
    const div = document.createElement('div');
    div.className = `message ${sender}`;
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  // Show tips on load
  window.addEventListener('DOMContentLoaded', () => {
    const tips = [
      'Tipp: Du kannst eine neue H√ºtte hinzuf√ºgen.',
      'Tipp: Gib "zeige meine H√ºtten" ein, um alle zu sehen.',
      'Tipp: Nutze "Standort senden" f√ºr deinen aktuellen Standort.'
    ];
    tips.forEach((tip, i) => {
      setTimeout(() => {
        const tipEl = document.createElement('div');
        tipEl.className = 'tip';
        tipEl.textContent = tip;
        messagesEl.appendChild(tipEl);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }, 500 + i * 800);
    });
    addMessage('Hallo! Wie kann ich dir helfen?');
  });

  inputEl.addEventListener('input', () => {
    sendBtn.disabled = inputEl.value.trim().length === 0;
  });

  sendBtn.addEventListener('click', () => handleUser(inputEl.value.trim()));
  inputEl.addEventListener('keypress', e => {
    if (e.key === 'Enter' && !sendBtn.disabled) {
      handleUser(inputEl.value.trim());
    }
  });

  function handleUser(msg) {
    addMessage(msg, 'user');
    inputEl.value = '';
    sendBtn.disabled = true;

    if (state === 'start') {
      parseCommand(msg);
    } else if (state === 'await_name') {
      tempData.name = msg;
      askLocationChoice();
    }
  }

  function parseCommand(msg) {
    const lmsg = msg.toLowerCase();
    if (lmsg.includes('neue h√ºtte')) {
      addMessage('Wie soll die neue H√ºtte hei√üen?');
      state = 'await_name';
    } else if (lmsg.includes('zeig') && lmsg.includes('h√ºtten')) {
      addMessage('Hier sind deine H√ºtten: (Beispiel)\n1) H√ºtte A\n2) H√ºtte B');
    } else if (lmsg.includes('standort')) {
      showLocationOptions();
    } else {
      addMessage('Ich habe das nicht verstanden. Versuche "neue H√ºtte", "zeige H√ºtten" oder "Standort senden".');
    }
  }

  function askLocationChoice() {
    addMessage('M√∂chtest du deinen aktuellen Standort senden oder manuell ausw√§hlen?');
    showLocationOptions();
    state = 'await_location';
  }

  function showLocationOptions() {
    const opts = document.createElement('div'); opts.id = 'location-options';
    const curBtn = document.createElement('button');
    curBtn.className = 'loc-btn'; curBtn.textContent = 'Aktueller Standort';
    const mapBtn = document.createElement('button');
    mapBtn.className = 'loc-btn'; mapBtn.textContent = 'Auf Karte w√§hlen';
    opts.append(curBtn, mapBtn);
    messagesEl.appendChild(opts);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    curBtn.onclick = getCurrentLocation;
    mapBtn.onclick = initMap;
  }

  function getCurrentLocation() {
    if (!navigator.geolocation) return addMessage('Geolocation wird nicht unterst√ºtzt.');
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      tempData.location = { latitude, longitude };
      addMessage(`üìç Dein Standort: ${latitude.toFixed(5)}, ${longitude.toFixed(5)}`);
      addMessage('Deine H√ºtte wurde eingetragen!');
      state = 'start';
    }, () => addMessage('Standort konnte nicht abgerufen werden.'));
  }

  function initMap() {
    mapEl.style.display = 'block';
    if (!map) {
      map = L.map(mapEl).setView([49.0, 8.4], 8);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OSM' }).addTo(map);
      map.on('click', e => {
        const { lat, lng } = e.latlng;
        if (marker) marker.remove();
        marker = L.marker([lat, lng]).addTo(map);
        tempData.location = { latitude: lat, longitude: lng };
        addMessage(`üìç Standort gew√§hlt: ${lat.toFixed(5)}, ${lng.toFixed(5)}`);
        addMessage('Deine H√ºtte wurde eingetragen!');
        state = 'start';
      });
    } else {
      map.invalidateSize();
    }
  }
</script></body>
</html>
