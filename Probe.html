<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hütten Assistent – Debug Version</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { font-family: sans-serif; }
    .sidebar-btn:hover { background-color: #10b981; color:white; }
    .card-option { transition: transform 0.2s, box-shadow 0.2s; }
    .card-option:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .selected { border:2px solid #10b981; background-color:#ecfdf5; }
  </style>
</head>
<body class="bg-gray-100">
<div class="flex min-h-screen">  <!-- Sidebar (mobile toggle) -->  <div id="sidebar" class="fixed md:static inset-y-0 left-0 w-60 bg-white border-r p-4 flex flex-col gap-3 transform -translate-x-full md:translate-x-0 transition-transform z-50">
    <div class="text-2xl font-bold text-green-700 mb-6">🌿 Assistent</div>
    <button class="sidebar-btn flex items-center gap-2 p-2 rounded" onclick="showMyEntries()">📋 Meine Eintragungen</button>
    <button class="sidebar-btn flex items-center gap-2 p-2 rounded" onclick="startNewEntry()">➕ Neue Eintragung</button>
    <button class="sidebar-btn flex items-center gap-2 p-2 rounded" onclick="openSupport()">💬 Support</button>
    <div class="mt-auto text-xs text-gray-400">v0.5 Debug</div>
  </div>  <!-- Main Content -->  <div class="flex-1 flex flex-col">
    <!-- Topbar for mobile -->
    <div class="md:hidden flex items-center justify-between bg-white border-b p-3">
      <div class="font-bold text-green-700">Assistent</div>
      <button onclick="toggleSidebar()" class="p-2 bg-green-600 text-white rounded">☰</button>
    </div><!-- Progressbar -->
<div class="w-full h-2 bg-gray-200">
  <div id="progress" class="h-2 bg-green-500 w-0 transition-all"></div>
</div>

<!-- Question Area -->
<div id="question-area" class="flex-1 flex flex-col items-center justify-center p-6 overflow-y-auto pb-24">
</div>

<!-- Navigation Buttons fixed bottom -->
<div class="fixed bottom-0 left-0 md:left-60 right-0 flex justify-between p-4 border-t bg-white">
  <button id="backBtn" class="px-4 py-2 bg-gray-200 rounded" onclick="prevStep()">⬅️ Zurück</button>
  <button id="nextBtn" class="px-4 py-2 bg-green-600 text-white rounded" onclick="nextStep()">Weiter ➡️</button>
</div>

  </div>
</div><script>
// ⚠️ Firebase Config prüfen
const firebaseConfig = {
  apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
  authDomain: "eierhuettentour.firebaseapp.com",
  projectId: "eierhuettentour",
  storageBucket: "eierhuettentour.appspot.com",
  messagingSenderId: "348272135205",
  appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc"
};

if(!firebaseConfig.apiKey){
  alert("❌ FirebaseConfig fehlt – bitte eintragen!");
}

let app, db;
try {
  app = firebase.initializeApp(firebaseConfig);
  db = firebase.firestore();
} catch(e){
  console.error("Firebase Init Error", e);
  document.getElementById("question-area").innerHTML = `<div class='bg-red-100 p-4 rounded'>❌ Firebase konnte nicht initialisiert werden.<br>${e}</div>`;
}

let currentUser = { uid: "demo" };
let editingData = {};
let step = 0;
const totalSteps = 10;

function saveField(field, value) {
  editingData[field] = value;
  editingData.step = step;
  console.log("💾 gespeichert:", field, value);
}

function updateProgress() {
  const percent = ((step) / (totalSteps-1)) * 100;
  document.getElementById("progress").style.width = percent + "%";
  console.log("📊 Progress", step, "/", totalSteps);
}

function renderQuestion() {
  const qa = document.getElementById("question-area");
  qa.innerHTML = `<div class='text-gray-400'>⏳ Lade Frage ${step}...</div>`;
  console.log("🔄 renderQuestion step", step);

  try {
    switch(step) {
      case 0:
        qa.innerHTML = `<div class="bg-white p-6 rounded-xl shadow max-w-lg w-full">
          <h2 class="text-xl font-bold mb-4">🛡️ Datenschutzerklärung</h2>
          <p class="mb-4">Bitte bestätige, dass du die Datenschutzerklärung akzeptierst.</p>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="dsCheck" /> Ich akzeptiere
          </label></div>`;
        break;
      case 1:
        qa.innerHTML = `<h2 class='text-xl font-bold mb-6'>Was möchtest du eintragen?</h2>`;
        const opts = ["🥚 Eierhütte","🏪 Hofladen","🤖 Selbstbedienungshäuschen","🛝 Spielplatz","🌄 Abenteuerhof"];
        const wrap = document.createElement("div");
        wrap.className = "grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl";
        opts.forEach(opt => {
          const card = document.createElement("div");
          card.className = "card-option bg-white p-6 rounded-xl shadow cursor-pointer text-center";
          card.innerHTML = `<div class='text-3xl mb-2'>${opt.split(" ")[0]}</div><div class='font-semibold'>${opt.substring(2)}</div>`;
          card.onclick = () => {
            document.querySelectorAll(".card-option").forEach(c=>c.classList.remove("selected"));
            card.classList.add("selected");
            editingData.typ = opt.substring(2);
            console.log("➡️ Typ gewählt:", editingData.typ);
          };
          wrap.appendChild(card);
        });
        qa.appendChild(wrap);
        break;
      default:
        qa.innerHTML = `<div class='bg-white p-6 rounded-xl shadow'>Step ${step} (Demo-Ausgabe)</div>`;
        break;
    }
  } catch(e){
    console.error("Render Error", e);
    qa.innerHTML = `<div class='bg-red-100 p-4 rounded'>❌ Fehler beim Rendern: ${e}</div>`;
  }

  updateProgress();
}

function nextStep(){
  if(step<totalSteps-1) step++;
  renderQuestion();
}

function prevStep(){
  if(step>0) step--;
  renderQuestion();
}

function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("-translate-x-full");
}

function showMyEntries(){
  if(!db){ alert("❌ Firestore nicht verfügbar"); return; }
  db.collection('eierhuetten').where('userId','==',currentUser.uid).get().then(snap=>{
    let list="";
    snap.forEach(doc=>{ let d=doc.data(); list+=`<li>${d.name||'Unbenannt'} – ${d.status}</li>`; });
    document.getElementById("question-area").innerHTML=`<div class='bg-white p-6 rounded-xl shadow w-full max-w-lg'><h2 class='text-xl mb-4'>Meine Eintragungen</h2><ul class='list-disc ml-4'>${list||'<li>Keine</li>'}</ul></div>`;
  }).catch(e=>{
    console.error("Firestore Error", e);
    alert("❌ Firestore Fehler: "+e);
  });
  toggleSidebar();
}

function openSupport(){
  document.getElementById("question-area").innerHTML=`<div class='bg-white p-6 rounded-xl shadow w-full max-w-lg'>
    <h2 class='text-xl mb-4'>Support</h2>
    <input id='supName' class='border p-2 w-full mb-2 rounded' placeholder='Dein Name'>
    <input id='supMail' class='border p-2 w-full mb-2 rounded' placeholder='Deine E-Mail'>
    <textarea id='supMsg' class='border p-2 w-full mb-2 rounded' rows='3' placeholder='Nachricht'></textarea><button class='px-4 py-2 bg-green-600 text-white rounded mt-2' onclick='sendSupport()'>Absenden</button></div>`;

toggleSidebar(); }

function sendSupport(){ if(!db){ alert("❌ Firestore nicht verfügbar"); return; } const sup={name:document.getElementById('supName').value,mail:document.getElementById('supMail').value,msg:document.getElementById('supMsg').value,time:new Date()}; db.collection('support').add(sup).then(()=>{alert('✅ Nachricht gesendet'); startNewEntry();}).catch(e=>{console.error(e);alert('❌ Fehler: '+e)}); }

function startNewEntry(){ step=0; editingData={}; renderQuestion(); }

// Init renderQuestion(); </script>

</body>
</html>
