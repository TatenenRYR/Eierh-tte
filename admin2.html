<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Admin – Betrag festlegen</title>
</head>
<body>
  <h1>Adminbereich: Monatlicher Betrag</h1>

  <label for="betrag">Neuer Betrag (€):</label>
  <input type="number" step="0.01" id="betrag">
  <button id="betragSpeichern">Speichern</button>

  <p id="aktuellerBetrag">Lade aktuellen Betrag...</p>

  <script type="module">
    // Firebase importieren
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // Konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
      authDomain: "eierhuettentour.firebaseapp.com",
      projectId: "eierhuettentour",
      storageBucket: "eierhuettentour.firebasestorage.app",
      messagingSenderId: "348272135205",
      appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc",
      measurementId: "G-16V6K5GXDT"
    };

    // Initialisierung
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const betragInput = document.getElementById("betrag");
    const speichernBtn = document.getElementById("betragSpeichern");
    const anzeige = document.getElementById("aktuellerBetrag");

    // Aktuellen Betrag laden
    async function ladeBetrag() {
      const docRef = doc(db, "settings", "gebuehren");
      const snap = await getDoc(docRef);
      if (snap.exists()) {
        const data = snap.data();
        anzeige.textContent = "Aktueller Betrag: €" + data.monatlicherBetrag;
      } else {
        anzeige.textContent = "Kein Betrag gesetzt.";
      }
    }

    ladeBetrag();

    // Speichern-Button
    speichernBtn.addEventListener("click", async () => {
      const neuerBetrag = parseFloat(betragInput.value);
      if (isNaN(neuerBetrag)) {
        alert("Bitte gültigen Betrag eingeben.");
        return;
      }

      const docRef = doc(db, "settings", "gebuehren");

      try {
        await setDoc(docRef, { monatlicherBetrag: neuerBetrag });
        alert("Betrag erfolgreich gespeichert.");
        ladeBetrag();
      } catch (err) {
        console.error("Fehler beim Speichern:", err);
        alert("Fehler beim Speichern: " + err.message);
      }
    });
  </script>
</body>
</html>
