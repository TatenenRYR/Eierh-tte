<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EierhÃ¼tten Assistent Chat</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #f3f4f6; font-family: Arial, sans-serif; }
    #chat-window { height: 500px; overflow-y: auto; padding: 1rem; background: #fff; border-radius: 0.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .message { clear: both; margin-bottom: 1rem; max-width: 75%; padding: 0.75rem 1rem; border-radius: 1rem; }
    .bot { float: left; background: #e0f2fe; color: #0369a1; }
    .user { float: right; background: #dcfce7; color: #166534; text-align: right; }
    #input-area { margin-top: 1rem; display: flex; gap: 0.5rem; }
    #chat-input { flex-grow: 1; padding: 0.5rem 1rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; }
    #send-btn { background: #0284c7; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; }
    #send-btn:hover { background: #0369a1; }
    button.choice-btn { background: #e0f2fe; border: 1px solid #0284c7; color: #0369a1; padding: 0.3rem 0.7rem; border-radius: 0.5rem; cursor: pointer; margin-right: 0.5rem; }
    button.choice-btn:hover { background: #bae6fd; }
    #map { width: 100%; height: 400px; margin-top: .75rem; border-radius: .5rem; }
    .hidden { display: none; }
  </style>
</head>
<body class="p-6">  <div id="login-section" class="max-w-md mx-auto text-center">
    <button id="google-login" class="bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded text-lg">
      Mit Google anmelden
    </button>
  </div>  <section id="main-section" class="max-w-md mx-auto mt-6 bg-white p-4 rounded-lg shadow hidden">
    <div class="text-center font-bold text-2xl text-green-700 mb-4">ðŸ¥š EierhÃ¼tten Assistent Chat</div><div id="key-section" class="mb-4">
  <input id="api-key" type="text" placeholder="OpenRouter API-Key eingeben"
    class="border border-gray-300 px-3 py-2 rounded w-full mb-2" />
  <button id="save-key" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full">Key speichern</button>
</div>

<div id="chat-window" aria-live="polite" role="log"></div>

<div id="input-area">
  <input id="chat-input" type="text" placeholder="Antwort hier..." autocomplete="off" class="border border-gray-300 rounded px-3 py-2"/>
  <button id="send-btn">Senden</button>
</div>

  </section>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
      authDomain: "eierhuettentour.firebaseapp.com",
      projectId: "eierhuettentour",
      storageBucket: "eierhuettentour.appspot.com",
      messagingSenderId: "348272135205",
      appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(), db = firebase.firestore();

    let currentUser = null;
    let OPENROUTER_KEY = localStorage.getItem('openrouter_api_key') || '';
    let step = 0, formData = {}, map, marker;

    const loginSection = document.getElementById('login-section');
    const mainSection = document.getElementById('main-section');
    const chatWindow = document.getElementById('chat-window');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const apiKeyInput = document.getElementById('api-key');
    const saveKeyBtn = document.getElementById('save-key');
    const keySection = document.getElementById('key-section');

    function addMessage(text, sender='bot') {
      const div = document.createElement('div');
      div.classList.add('message', sender);
      div.textContent = text;
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function addChoiceButtons(options, callback) {
      const container = document.createElement('div');
      container.classList.add('message', 'bot');
      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = opt;
        btn.addEventListener('click', () => {
          addMessage(opt, 'user');
          container.remove();
          callback(opt.toLowerCase());
        });
        container.appendChild(btn);
      });
      chatWindow.appendChild(container);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function checkApiKey() {
      if (OPENROUTER_KEY.length > 20) {
        keySection.classList.add('hidden');
        startDialog();
      } else {
        keySection.classList.remove('hidden');
      }
    }

    saveKeyBtn.addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (key.length > 20) {
        OPENROUTER_KEY = key;
        localStorage.setItem('openrouter_api_key', key);
        checkApiKey();
      } else alert('Bitte gÃ¼ltigen API-Key eingeben.');
    });

    auth.onAuthStateChanged(u => {
      if (u) {
        currentUser = u;
        loginSection.classList.add('hidden');
        mainSection.classList.remove('hidden');
        apiKeyInput.value = OPENROUTER_KEY;
        checkApiKey();
      } else {
        currentUser = null;
        loginSection.classList.remove('hidden');
        mainSection.classList.add('hidden');
      }
    });

    document.getElementById('google-login').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    sendBtn.addEventListener('click', onUserInput);
    chatInput.addEventListener('keydown', e => { if(e.key==='Enter') onUserInput(); });

    function onUserInput() {
      const txt = chatInput.value.trim();
      if (!txt) return;
      addMessage(txt, 'user');
      chatInput.value = '';
      if (step === 0) detectIntent(txt.toLowerCase());
      else handleStep(txt.toLowerCase());
    }

    function detectIntent(input) {
      if (input.includes('neu') || input.includes('einreichen')) {
        formData = {};
        step = 1;
        addMessage('Wie soll deine EierhÃ¼tte heiÃŸen?', 'bot');
      } else if (input.includes('bearbeiten')) {
        addMessage('Gib bitte den Namen der HÃ¼tte an, die du bearbeiten willst.', 'bot');
      } else if (input.includes('liste') || input.includes('meine')) {
        addMessage('Hier sind deine HÃ¼tten (Feature folgt)...', 'bot');
      } else {
        addMessage('Ich habe das nicht ganz verstanden. Was mÃ¶chtest du tun?', 'bot');
        addChoiceButtons(['Neue HÃ¼tte einreichen', 'Meine HÃ¼tten ansehen', 'HÃ¼tte bearbeiten'], choice => detectIntent(choice));
      }
    }

    function handleStep(input) {
      switch (step) {
        case 1:
          formData.name = input;
          addMessage('Gibt es SitzplÃ¤tze?', 'bot');
          addChoiceButtons(['Ja', 'Nein'], choice => {
            formData.sitzplaetze = choice;
            step = 2;
            handleStep('');
          });
          break;
        case 2:
          addMessage('Gibt es Strom?', 'bot');
          addChoiceButtons(['Ja', 'Nein'], choice => {
            formData.strom = choice;
            step = 3;
            handleStep('');
          });
          break;
        case 3:
          addMessage('Gib noch Extras an (optional) oder schreibe â€žÃœberspringenâ€œ.', 'bot');
          step = 4;
          break;
        case 4:
          formData.extras = input.includes('Ã¼berspring') ? '' : input;
          step = 0;
          addMessage('Danke! Deine Daten wurden gespeichert (Feature folgt).');
          break;
      }
    }
  </script></body>
</html>
