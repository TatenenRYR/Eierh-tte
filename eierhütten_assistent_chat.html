<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eierhütten Assistent</title>
  <style>
    body { font-family: sans-serif; background: #f3f4f6; padding: 2rem; }
    #chat { max-width: 600px; margin: auto; background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .msg { margin: 1rem 0; }
    .user { text-align: right; }
    .bot { text-align: left; color: #333; }
    input, button { padding: 0.5rem; font-size: 1rem; width: 100%; margin-top: 0.5rem; }
    input[type="file"] { padding: 0; }
  </style>
</head>
<body>
  <div id="chat">
    <div id="messages"></div>
    <form id="chatForm">
      <input type="text" id="userInput" placeholder="Antwort eingeben..." required />
      <input type="file" id="photoInput" accept="image/*" style="display:none" />
      <button type="submit">Senden</button>
    </form>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    // Firebase-Konfiguration
    const firebaseConfig = {
      apiKey: "DEIN_API_KEY",
      authDomain: "DEIN_PROJEKT.firebaseapp.com",
      projectId: "DEIN_PROJEKT",
      storageBucket: "DEIN_PROJEKT.appspot.com",
      messagingSenderId: "...",
      appId: "..."
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    const messages = document.getElementById('messages');
    const form = document.getElementById('chatForm');
    const input = document.getElementById('userInput');
    const photoInput = document.getElementById('photoInput');

    let step = 0;
    let formData = {};

    const prompts = [
      "Wie heißt die Hütte?",
      "Wo befindet sich die Hütte (Adresse oder Koordinaten)?",
      "Gibt es besondere Merkmale (z. B. Stromversorgung, Sitzplätze)?",
      "Möchtest du ein Foto hochladen? (Ja/Nein)",
      "Bitte lade jetzt das Foto hoch.",
      "Vielen Dank! Die Hütte wurde übermittelt."
    ];

    function addMessage(text, sender = 'bot') {
      const div = document.createElement('div');
      div.className = 'msg ' + sender;
      div.textContent = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    function nextPrompt() {
      if (step < prompts.length) {
        if (step === 4) {
          photoInput.style.display = 'block';
        } else {
          photoInput.style.display = 'none';
        }
        addMessage(prompts[step]);
      }
    }

    addMessage("Hallo! Ich helfe dir dabei, eine neue Hütte einzureichen.");
    nextPrompt();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const val = input.value.trim();
      if (!val && step !== 4) return;
      addMessage(val, 'user');
      input.value = '';

      if (step === 0) formData.name = val;
      if (step === 1) formData.standort = val;
      if (step === 2) formData.besonderheiten = val;

      if (step === 3 && val.toLowerCase() === 'ja') {
        step++;
        nextPrompt();
        return;
      }

      if (step === 3 && val.toLowerCase() === 'nein') {
        formData.fotoUrl = null;
        await submitForm();
        return;
      }

      if (step === 4) {
        const file = photoInput.files[0];
        if (!file) {
          addMessage("Bitte wähle eine Bilddatei aus.");
          return;
        }
        const storageRef = storage.ref('eierhuetten/' + Date.now() + '_' + file.name);
        const uploadTask = await storageRef.put(file);
        const downloadURL = await uploadTask.ref.getDownloadURL();
        formData.fotoUrl = downloadURL;
        await submitForm();
        return;
      }

      step++;
      nextPrompt();
    });

    async function submitForm() {
      formData.status = 'offen';
      formData.timestamp = new Date();
      await db.collection('eierhuetten_antraege').add(formData);
      step++;
      nextPrompt();
    }
  </script>
</body>
</html>
