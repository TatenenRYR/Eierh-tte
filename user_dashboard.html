<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meine Eierhütten</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f4f8; }
    header, main { padding: 20px; }
    header { background: #4CAF50; color: white; display: flex; justify-content: space-between; align-items: center; }
    .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    #map { height: 300px; border-radius: 12px; margin-bottom: 10px; }
    label { display: block; margin-top: 10px; }
    input, textarea, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-top: 5px; }
    button { background: #4CAF50; color: white; cursor: pointer; margin-top: 15px; }
    button.edit { background: #0277bd; }
    button.delete { background: #b71c1c; }
  </style>
</head>
<body>
<header>
  <h2>Meine Eierhütten</h2>
  <button id="logoutBtn">Logout</button>
</header>
<main>
  <div class="card">
    <h3>Neue Hütte einreichen</h3>
    <label for="hutName">Name der Hütte *</label>
    <input id="hutName" type="text" placeholder="z.B. Bergblick" required /><label for="description">Beschreibung *</label>
<textarea id="description" rows="4" placeholder="Kurze Beschreibung..." required></textarea>

<label for="locationSearch">Ort suchen</label>
<input id="locationSearch" type="text" placeholder="Ort, Adresse..." />
<button onclick="searchOrt()">Ort übernehmen</button>

<div id="map"></div>

<button id="submitHut">Einreichen</button>

  </div>  <div class="card">
    <h3>Meine eingereichten Hütten</h3>
    <div id="userHuts">Lade...</div>
  </div>
</main><script>
  // Firebase config
  const firebaseConfig = { apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro", authDomain: "eierhuettentour.firebaseapp.com", projectId: "eierhuettentour", storageBucket: "eierhuettentour.firebasestorage.app", messagingSenderId: "348272135205", appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc" };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser, map, marker;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      loadUserHuts();
      initMap();
    } else {
      firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
    }
  });

  document.getElementById('logoutBtn').onclick = () => auth.signOut();

  function initMap() {
    map = L.map('map').setView([51.1657, 10.4515], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    marker = L.marker([51.1657, 10.4515], { draggable: true }).addTo(map);
    marker.on('dragend', () => {});
  }

  async function searchOrt() {
    const q = document.getElementById('locationSearch').value;
    if (!q) return;
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`);
    const data = await res.json();
    if (data.length) {
      const { lat, lon } = data[0];
      map.setView([lat, lon], 14);
      marker.setLatLng([lat, lon]);
    } else alert('Ort nicht gefunden');
  }

  document.getElementById('submitHut').onclick = async () => {
    const name = document.getElementById('hutName').value.trim();
    const desc = document.getElementById('description').value.trim();
    const pos = marker.getLatLng();
    if (!name || !desc) return alert('Bitte Name und Beschreibung ausfüllen');
    await db.collection('eierhuetten').add({ name, beschreibung: desc, standort: new firebase.firestore.GeoPoint(pos.lat,pos.lng), userId: currentUser.uid, status: 'offen', timestamp: firebase.firestore.FieldValue.serverTimestamp() });
    loadUserHuts();
  };

  async function loadUserHuts() {
    const snap = await db.collection('eierhuetten').where('userId','==',currentUser.uid).get();
    const container = document.getElementById('userHuts'); container.innerHTML = '';
    snap.forEach(doc => {
      const d = doc.data();
      const div = document.createElement('div'); div.className='card';
      div.innerHTML = `
        <strong>${d.name}</strong> <small>(${d.status})</small><br>
        ${d.beschreibung}<br>
        <button class='edit' onclick="editHut('${doc.id}','${d.name}','${d.beschreibung}')">Bearbeiten</button>
        <button class='delete' onclick="deleteHut('${doc.id}')">Löschen</button>
      `;
      container.appendChild(div);
    });
  }

  function editHut(id,name,desc) {
    const n = prompt('Neuer Name:',name); const d = prompt('Neue Beschreibung:',desc);
    if (n&&d) db.collection('eierhuetten').doc(id).update({ name:n, beschreibung:d, status:'überarbeitet' }).then(loadUserHuts);
  }

  function deleteHut(id) {
    if(confirm('Löschen?')) db.collection('eierhuetten').doc(id).delete().then(loadUserHuts);
  }
</script></body>
</html>
