<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eierhütten User Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    header, nav, section { padding: 1rem; }
    header { background: #4caf50; color: white; text-align: center; }
    nav { background: #eee; display: flex; gap: 1rem; justify-content: center; }
    nav button { padding: 0.5rem 1rem; cursor: pointer; }
    .hidden { display: none; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; }
    input, textarea, select { width: 100%; padding: 0.5rem; }
    #map, .mini-map { height: 300px; }
    .mini-map { height: 150px; pointer-events: none; }
    .card { background: white; padding: 1rem; margin: 1rem 0; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <header>
    <h1>Eierhütten Dashboard</h1>
    <button id="loginBtn">Mit Google anmelden</button>
    <button id="logoutBtn" class="hidden">Abmelden</button>
  </header>  <nav id="dashboardNav" class="hidden">
    <button onclick="showSection('create')">Eierhütte eintragen</button>
    <button onclick="showSection('myhuts')">Meine Eierhütten</button>
    <button onclick="showSection('settings')">Einstellungen</button>
  </nav>  <section id="create" class="hidden">
    <h2>Neue Eierhütte einreichen</h2>
    <form id="hutForm">
      <div class="form-group">
        <label>Name der Hütte</label>
        <input type="text" id="hutName" required>
      </div>
      <div class="form-group">
        <label>Beschreibung</label>
        <textarea id="hutDescription"></textarea>
      </div>
      <div class="form-group">
        <label>Monatlicher Betrag (€)</label>
        <input type="number" id="monthlyAmount" value="2.00" step="0.01">
      </div>
      <div id="map"></div>
      <button type="submit">Absenden</button>
    </form>
  </section>  <section id="myhuts" class="hidden">
    <h2>Meine Eierhütten</h2>
    <div id="hutList"></div>
  </section>  <section id="settings" class="hidden">
    <h2>Einstellungen</h2>
    <p>Weitere Optionen folgen...</p>
  </section>  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
      authDomain: "eierhuettentour.firebaseapp.com",
      projectId: "eierhuettentour",
      storageBucket: "eierhuettentour.firebasestorage.app",
      messagingSenderId: "348272135205",
      appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let map, marker;

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const dashboardNav = document.getElementById("dashboardNav");

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loginBtn.classList.add("hidden");
        logoutBtn.classList.remove("hidden");
        dashboardNav.classList.remove("hidden");
        showSection('create');
        loadMyHuts();
      } else {
        currentUser = null;
        loginBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");
        dashboardNav.classList.add("hidden");
        hideAllSections();
      }
    });

    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };

    logoutBtn.onclick = () => auth.signOut();

    function showSection(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if (id === 'create') initMap();
    }

    function hideAllSections() {
      document.querySelectorAll("section").forEach(sec => sec.classList.add("hidden"));
    }

    function initMap() {
      if (map) return;
      map = L.map('map').setView([51.5, 10], 6);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
      marker = L.marker([51.5, 10], { draggable: true }).addTo(map);
      map.on('click', e => marker.setLatLng(e.latlng));
    }

    document.getElementById("hutForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!currentUser) return;
      const data = {
        name: hutName.value,
        description: hutDescription.value,
        lat: marker.getLatLng().lat,
        lng: marker.getLatLng().lng,
        userId: currentUser.uid,
        status: "offen",
        monthly: parseFloat(monthlyAmount.value),
        created: firebase.firestore.FieldValue.serverTimestamp()
      };
      await db.collection("eierhuetten_antraege").add(data);
      alert("Eierhütte eingereicht!");
      hutForm.reset();
      marker.setLatLng([51.5, 10]);
    });

    async function loadMyHuts() {
      if (!currentUser) return;
      const snapshot = await db.collection("eierhuetten_antraege")
        .where("userId", "==", currentUser.uid).get();
      const container = document.getElementById("hutList");
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const hut = doc.data();
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<h3>${hut.name}</h3>
          <p>${hut.description}</p>
          <p>Status: <strong>${hut.status}</strong></p>
          <div id="mini-${doc.id}" class="mini-map"></div>`;
        container.appendChild(div);
        const miniMap = L.map(`mini-${doc.id}`, { zoomControl: false, dragging: false });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);
        miniMap.setView([hut.lat, hut.lng], 13);
        L.marker([hut.lat, hut.lng]).addTo(miniMap);
      });
    }
  </script></body>
</html>
