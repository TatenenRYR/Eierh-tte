<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RadlMap Startseite</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { margin:0; font-family:'Segoe UI', Roboto, sans-serif; background:#f0f8ff; }
  header { background:url('https://images.unsplash.com/photo-1587049352843-65941c9f2e38?fit=crop&w=1200&q=80') center/cover no-repeat; height:220px; display:flex; align-items:center; justify-content:center; color:white; font-size:2rem; font-weight:bold; text-shadow:1px 1px 6px rgba(0,0,0,0.5);}
  main { padding:16px; }
  .huts-container { display:flex; flex-wrap:wrap; gap:16px; justify-content:center; margin-bottom:24px; }
  .card { background:white; border-radius:1rem; overflow:hidden; width:90%; max-width:320px; box-shadow:0 4px 12px rgba(0,0,0,0.2); cursor:pointer; transition:transform 0.2s; }
  .card:hover { transform:scale(1.03); }
  .card img { width:100%; height:180px; object-fit:cover; }
  .card .info { padding:14px; }
  .card .info h4 { margin:0 0 8px; font-size:1.2rem; color:#333; }
  .details { font-size:0.9rem; color:#555; line-height:1.4; }
  .details span { display:block; margin:4px 0; }
  .icon { margin-right:6px; }
  /* Slide-Up Popup */
  #hut-popup { display:flex; flex-direction:column; justify-content:flex-end; position:fixed; inset:0; background: rgba(0,0,0,0.4); z-index:5000; pointer-events:none; transition: background 0.3s; }
  #hut-popup-content { background:white; border-radius:1rem 1rem 0 0; padding:1.5rem; max-width:500px; width:100%; margin:auto; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); position:relative; }
  #hut-popup-close { position:absolute; top:10px; right:15px; font-size:1.5rem; cursor:pointer; }
  #instagram { margin-top:24px; text-align:center; }
  #instagram iframe { border:none; width:100%; max-width:500px; height:600px; border-radius:1rem; }
</style>
</head>
<body>

<header>RadlMap – Deine Fahrradstopps</header>

<main>
  <h2 style="text-align:center;">Neueste Hütten</h2>
  <div class="huts-container" id="huts-container">
    <!-- Hütte-Karten werden hier eingefügt -->
  </div>

  <h2 style="text-align:center;">Instagram News</h2>
  <div id="instagram">
    <iframe src="https://www.instagram.com/radlmap/embed" scrolling="no" allowtransparency="true"></iframe>
  </div>
</main>

<!-- Hütte Popup -->
<div id="hut-popup">
  <div id="hut-popup-content">
    <span id="hut-popup-close">&times;</span>
    <h3 id="popup-name"></h3>
    <div id="popup-map" style="height:200px; border-radius:1rem; margin-bottom:1rem;"></div>
    <p><b>Öffnungszeiten:</b> <span id="popup-oeffnungszeiten"></span></p>
    <p><b>Strom:</b> <span id="popup-strom"></span></p>
    <p><b>Erstellt am:</b> <span id="popup-datum"></span></p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyD7pocrD9_46QNoz1jrxggpzkL7E6IhetY",
  authDomain: "einkaufliste-cd5d3.firebaseapp.com",
  projectId: "einkaufliste-cd5d3",
  storageBucket: "einkaufliste-cd5d3.appspot.com",
  messagingSenderId: "36721747923",
  appId: "1:36721747923:web:dbe48ff974c80435eff126"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Popup-Funktionen
function openHutPopup(h) {
  const popup = document.getElementById("hut-popup");
  const content = document.getElementById("hut-popup-content");
  popup.style.pointerEvents = "all";
  popup.style.background = "rgba(0,0,0,0.4)";
  content.style.transform = "translateY(0)";

  document.getElementById("popup-name").textContent = h.name || "Unbenannt";
  document.getElementById("popup-oeffnungszeiten").textContent = h.oeffnungszeiten || "-";
  document.getElementById("popup-strom").textContent = h.strom || "-";
  document.getElementById("popup-datum").textContent = h.erstelltAm?.toDate?.().toLocaleDateString("de-DE") || "-";

  const mapDiv = document.getElementById("popup-map");
  mapDiv.innerHTML = "";
  const popupMap = L.map(mapDiv, {
    center: [h.location.latitude, h.location.longitude],
    zoom: 15,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    zoomControl: false,
    attributionControl: false
  });
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(popupMap);
  L.marker([h.location.latitude, h.location.longitude]).addTo(popupMap);
}
function closeHutPopup() {
  const popup = document.getElementById("hut-popup");
  const content = document.getElementById("hut-popup-content");
  content.style.transform = "translateY(100%)";
  popup.style.background = "rgba(0,0,0,0)";
  popup.style.pointerEvents = "none";
}
document.getElementById("hut-popup-close").onclick = closeHutPopup;

// Hütten abrufen
const container = document.getElementById("huts-container");
db.collection("eierhuetten").where("status", "==", "angenommen").get()
  .then(snapshot => {
    let huts = snapshot.docs.map(doc => ({id:doc.id, ...doc.data()}));
    huts.sort((a,b) => b.erstelltAm?.seconds - a.erstelltAm?.seconds); // neueste zuerst
    huts.slice(0,3).forEach(h => {
      const card = document.createElement("div");
      card.className = "card";

      // Bild
      const img = document.createElement("img");
      img.src = h.fotos?.[0] || "https://via.placeholder.com/320x180?text=Keine+Fotos";
      card.appendChild(img);

      // Info
      const info = document.createElement("div");
      info.className = "info";
      info.innerHTML = `
        <h4>${h.name || "Unbenannt"}</h4>
        <div class="details">
          <span><b>Öffnungszeiten:</b> ${h.oeffnungszeiten || "-"}</span>
          <span><b>Strom:</b> ${h.strom ? "⚡ Ja" : "❌ Nein"}</span>
          <span><b>Erstellt:</b> ${h.erstelltAm?.toDate?.().toLocaleDateString("de-DE") || "-"}</span>
        </div>
      `;
      card.appendChild(info);

      card.onclick = () => openHutPopup(h);
      container.appendChild(card);
    });
  })
  .catch(err => console.error(err));
</script>

</body>
</html>
