<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Naturpark Moor-Veenland ‚Äì RadlMap</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { margin:0; font-family:'Segoe UI', Roboto, sans-serif; background:#f8fdf7; color:#333; }
  h2 { text-align:center; color:#0077b6; margin:2rem 0 1rem; }

  /* Header */
  header {
    background:url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?fit=crop&w=1400&q=80') center/cover no-repeat;
    height:240px; display:flex; flex-direction:column; align-items:center; justify-content:center;
    color:white; text-shadow:1px 1px 6px rgba(0,0,0,0.6);
  }
  header h1 { margin:0; font-size:2.2rem; font-weight:bold; }
  header p { margin:6px 0 0; font-size:1.2rem; }

  /* Karten */
  .huts-container { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; padding:0 16px; }
  .card {
    background:white; border-radius:1rem; overflow:hidden;
    width:90%; max-width:320px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
    cursor:pointer; transition:transform 0.2s;
  }
  .card:hover { transform:scale(1.03); }
  .card img { width:100%; height:180px; object-fit:cover; }
  .info { padding:14px; }
  .info h3 { margin:0 0 10px; color:#7BBF42; font-size:1.2rem; }
  .details { font-size:0.9rem; color:#555; }
  .details span { display:block; margin:4px 0; }

  /* Popup */
  #hut-popup { display:flex; flex-direction:column; justify-content:flex-end; position:fixed; inset:0; background: rgba(0,0,0,0.4); z-index:5000; pointer-events:none; transition: background 0.3s; }
  #hut-popup-content { background:white; border-radius:1rem 1rem 0 0; padding:1.5rem; max-width:500px; width:100%; margin:auto; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); position:relative; }
  #hut-popup-close { position:absolute; top:10px; right:15px; font-size:1.5rem; cursor:pointer; }

  .popup-image-container { position:relative; margin-bottom:1rem; }
  .popup-image-container img { width:100%; border-radius:1rem; max-height:200px; object-fit:cover; }
  .popup-image-container button {
    position:absolute; top:50%; transform:translateY(-50%);
    background:#0008; color:#fff; border:none; padding:6px 10px;
    cursor:pointer; font-size:1rem;
  }
  .popup-image-container .left { left:0; border-radius:0 8px 8px 0; }
  .popup-image-container .right { right:0; border-radius:8px 0 0 8px; }

  /* Instagram */
  #instagram { margin:2rem auto; text-align:center; }
  #instagram iframe { border:none; width:100%; max-width:500px; height:600px; border-radius:1rem; }

  /* Footer */
  footer { background:#7BBF42; color:white; text-align:center; padding:12px; font-size:0.9rem; margin-top:2rem; }
</style>
</head>
<body>

<header>
  <h1>Naturpark Moor-Veenland</h1>
  <p>Kiek moal in! ‚Äì RadlMap Fahrradstopps</p>
</header>

<main>
  <h2>Unsere neuesten H√ºtten</h2>
  <div class="huts-container" id="huts-container">
    <!-- H√ºtten-Karten werden hier eingef√ºgt -->
  </div>

  <h2>Instagram News</h2>
  <div id="instagram">
    <iframe src="https://www.instagram.com/radlmap/embed" scrolling="no" allowtransparency="true"></iframe>
  </div>
</main>

<!-- H√ºtte Popup -->
<div id="hut-popup">
  <div id="hut-popup-content">
    <span id="hut-popup-close">&times;</span>
    <h3 id="popup-name"></h3>
    <div class="popup-image-container" id="popup-images"></div>
    <div id="popup-map" style="height:200px; border-radius:1rem; margin-bottom:1rem;"></div>
    <p><b>√ñffnungszeiten:</b> <span id="popup-oeffnungszeiten"></span></p>
    <p><b>Strom:</b> <span id="popup-strom"></span></p>
    <p><b>Sitzpl√§tze:</b> <span id="popup-sitzplaetze"></span></p>
    <p><b>Extras:</b> <span id="popup-extras"></span></p>
    <p><b>Start:</b> <span id="popup-start"></span></p>
  </div>
</div>

<footer>
  ¬© 2025 Naturpark Moor-Veenland ‚Äì RadlMap | Mit dem Fahrrad die Region entdecken
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyD7pocrD9_46QNoz1jrxggpzkL7E6IhetY",
  authDomain: "einkaufliste-cd5d3.firebaseapp.com",
  projectId: "einkaufliste-cd5d3",
  storageBucket: "einkaufliste-cd5d3.appspot.com",
  messagingSenderId: "36721747923",
  appId: "1:36721747923:web:dbe48ff974c80435eff126"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Slideshow ---
function renderSlideshow(container, bilderUrls) {
  if (!bilderUrls || bilderUrls.length === 0) {
    container.innerHTML = `<div style="height:140px; background:#ccc; display:flex; 
      align-items:center; justify-content:center; border-radius:8px;">Kein Bild</div>`;
    return;
  }
  let index = 0;
  function updateImage() {
    container.innerHTML = `
      <img src="${bilderUrls[index]}" alt="H√ºttenbild">
      ${bilderUrls.length > 1 ? `
        <button class="left">‚Üê</button>
        <button class="right">‚Üí</button>
      ` : ""}
    `;
    if (bilderUrls.length > 1) {
      container.querySelector(".left").onclick = () => { index = (index - 1 + bilderUrls.length) % bilderUrls.length; updateImage(); };
      container.querySelector(".right").onclick = () => { index = (index + 1) % bilderUrls.length; updateImage(); };
    }
  }
  updateImage();
}

// --- Popup-Funktionen ---
function openHutPopup(d, bilderUrls) {
  const popup = document.getElementById("hut-popup");
  const content = document.getElementById("hut-popup-content");
  popup.style.pointerEvents = "all";
  popup.style.background = "rgba(0,0,0,0.4)";
  content.style.transform = "translateY(0)";

  document.getElementById("popup-name").textContent = d.name || "Unbenannt";
  document.getElementById("popup-oeffnungszeiten").textContent = d.oeffnungszeiten || "-";
  document.getElementById("popup-strom").textContent = d.strom === "Ja" ? "‚úÖ Ja" : "‚ùå Nein";
  document.getElementById("popup-sitzplaetze").textContent = d.sitzplaetze === "Ja" ? "‚úÖ Ja" : "‚ùå Nein";
  document.getElementById("popup-extras").textContent = d.extras || "‚Äì";
  document.getElementById("popup-start").textContent = d.aboStart?.toDate?.().toLocaleDateString("de-DE") || "-";

  // Bilder
  const imgContainer = document.getElementById("popup-images");
  renderSlideshow(imgContainer, bilderUrls);

  // Map
  const mapDiv = document.getElementById("popup-map");
  mapDiv.innerHTML = "";
  if (d.location?.latitude && d.location?.longitude) {
    const popupMap = L.map(mapDiv, {
      center: [d.location.latitude, d.location.longitude],
      zoom: 15,
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      boxZoom: false,
      zoomControl: false,
      attributionControl: false
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(popupMap);
    L.marker([d.location.latitude, d.location.longitude]).addTo(popupMap);
  }
}
function closeHutPopup() {
  const popup = document.getElementById("hut-popup");
  const content = document.getElementById("hut-popup-content");
  content.style.transform = "translateY(100%)";
  popup.style.background = "rgba(0,0,0,0)";
  popup.style.pointerEvents = "none";
}
document.getElementById("hut-popup-close").onclick = closeHutPopup;

// --- H√ºtten laden ---
const container = document.getElementById("huts-container");
db.collection("eierhuetten").onSnapshot(snap => {
  
  container.innerHTML = ""; // reset
  snap.forEach(doc => {
    
    const d = doc.data();
    console.log("üü¢ H√ºtte: " d.name);

    if (!d.location || d.status != "angenommen") return;

    // Bilder pr√ºfen
    const freigegebeneBilder = Array.isArray(d.fotos)
      ? d.fotos.filter(f => typeof f === 'string' || f.status === 'freigegeben')
      : [];
    const bilderUrls = freigegebeneBilder.map(f =>
      typeof f === 'string' ? f : f.url
    );
    const erstesBild = bilderUrls[0] || "https://via.placeholder.com/320x180?text=Keine+Fotos";

    // Karte bauen
    const card = document.createElement("div");
    card.className = "card";

    const img = document.createElement("img");
    img.src = erstesBild;
    card.appendChild(img);

    const info = document.createElement("div");
    info.className = "info";
    info.innerHTML = `
      <h3>${d.name || "Unbenannt"}</h3>
      <div class="details">
        <span><b>√ñffnungszeiten:</b> ${d.oeffnungszeiten || "-"}</span>
        <span><b>Strom:</b> ${d.strom === "Ja" ? "‚ö° Ja" : "‚ùå Nein"}</span>
        <span><b>Sitzpl√§tze:</b> ${d.sitzplaetze === "Ja" ? "‚úÖ Ja" : "‚ùå Nein"}</span>
        <span><b>Extras:</b> ${d.extras || "‚Äì"}</span>
        <span><b>Start:</b> ${d.aboStart?.toDate?.().toLocaleDateString("de-DE") || "-"}</span>
      </div>
    `;
    card.appendChild(info);

    card.onclick = () => openHutPopup(d, bilderUrls);
    container.appendChild(card);
  });
});
  
        // --- In-App Konsole mit Toggle & Scrollbar ---
(function() {
  // üëâ hier kannst du die Konsole global aktivieren/deaktivieren
  const ENABLE_APP_CONSOLE = true;  // auf false setzen = deaktiviert

  if (!ENABLE_APP_CONSOLE) return; // komplett abschalten

  const consoleDiv = document.createElement("div");
  consoleDiv.id = "appConsole";
  consoleDiv.style.cssText = `
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-height: 200px;
    overflow-y: auto;          /* Scrollbalken aktiv */
    background: rgba(0,0,0,0.85);
    color: #0f0;
    font-family: monospace;
    font-size: 12px;
    padding: 5px;
    z-index: 9999;
    display: none;             /* startet versteckt */
    box-sizing: border-box;
    user-select: text;      /* üëâ Markieren/Kopieren erlaubt */
    cursor: text;           /* Cursor als Textanzeige */
  `;
  document.body.appendChild(consoleDiv);

  // Toggle-Button
  const toggleBtn = document.createElement("button");
  toggleBtn.textContent = "üìù Logs";
  toggleBtn.style.cssText = `
    position: fixed;
    bottom: 210px;
    right: 10px;
    padding: 5px 10px;
    background: #222;
    color: white;
    border: 1px solid #555;
    border-radius: 6px;
    font-size: 14px;
    z-index: 10000;
    cursor: pointer;
  `;
  document.body.appendChild(toggleBtn);

  let consoleVisible = false;
  toggleBtn.onclick = () => {
    consoleVisible = !consoleVisible;
    consoleDiv.style.display = consoleVisible ? "block" : "none";
    toggleBtn.textContent = consoleVisible ? "üìï Logs schlie√üen" : "üìù Logs";
  };

  function printToConsole(type, args) {
    const msg = document.createElement("div");
    msg.style.whiteSpace = "pre-wrap";
    msg.style.color =
      type === "error" ? "red" :
      type === "warn"  ? "yellow" :
      "#0f0";
    msg.textContent = `[${type.toUpperCase()}] ` + args.map(a =>
      (typeof a === "object" ? JSON.stringify(a) : a)
    ).join(" ");
    consoleDiv.appendChild(msg);

    // automatisch nach unten scrollen
    consoleDiv.scrollTop = consoleDiv.scrollHeight;
  }

  // Original-Methoden sichern
  const origLog = console.log;
  const origWarn = console.warn;
  const origError = console.error;

  console.log = function(...args) {
    origLog.apply(console, args);
    printToConsole("log", args);
  };
  console.warn = function(...args) {
    origWarn.apply(console, args);
    printToConsole("warn", args);
  };
  console.error = function(...args) {
    origError.apply(console, args);
    printToConsole("error", args);
  };

  console.log("üü¢ In-App Konsole gestartet (mit Scrollbalken + Deaktivier-Variable)");
  // üëâ F√§ngt normale JavaScript-Fehler ab
/*window.addEventListener("error", function (event) {
  console.error("Uncaught Error:", event.message, event.filename, ":", event.lineno);
});

// üëâ F√§ngt Promise-Fehler (async/await) ab
window.addEventListener("unhandledrejection", function (event) {
  console.error("Unhandled Promise rejection:", event.reason);
});*/
})();

</script>

</body>
</html>
