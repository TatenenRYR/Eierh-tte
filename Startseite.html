<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RadlMap</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { margin:0; font-family:'Segoe UI', Roboto, sans-serif; background:#f8fdf7; color:#333; }
  h2 { text-align:center; color:#0077b6; margin:2rem 0 1rem; }

  /* Header mit 8-Bit Wolken */
 header {
  position: relative;
  background: linear-gradient(to top, #7ec8f7, #cdefff);
  overflow: hidden;
  height: 240px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  text-shadow: 1px 1px 6px rgba(0,0,0,0.6);
}
 
  header h1 { margin:0; font-size:2.2rem; font-weight:bold; }
  header p { margin:6px 0 0; font-size:1.2rem; }

  /* H√ºtten-Karten */
  .huts-container { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; padding:0 16px; }
  .card {
    background:white;
    border-radius:1rem;
    width:90%; max-width:320px;
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
    overflow:hidden;
    cursor:pointer;
    transition:transform 0.2s;
    border:3px solid #7BBF42;
  }
  .card:hover { transform:scale(1.03); }
  .info { padding:14px; }
  .info h3 { margin:0 0 10px; color:#0077b6; font-size:1.2rem; }
  .details { font-size:0.9rem; color:#555; }
  .details span { display:block; margin:4px 0; }

  /* Popup */
  #hut-popup { display:none; flex-direction:column; justify-content:flex-end; position:fixed; inset:0; background: rgba(0,0,0,0.4); z-index:5000; transition: background 0.3s; }
  #hut-popup-content { background:white; border-radius:1rem 1rem 0 0; padding:1.5rem; max-width:500px; width:100%; margin:auto; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); position:relative; }
  #hut-popup-close { position:absolute; top:10px; right:15px; font-size:1.5rem; cursor:pointer; }

  .popup-image-container { position:relative; margin-bottom:1rem; }
  .popup-image-container img { width:100%; border-radius:1rem; max-height:200px; object-fit:cover; }
  .popup-image-container button {
    position:absolute; top:50%; transform:translateY(-50%);
    background:#0008; color:#fff; border:none; padding:6px 10px;
    cursor:pointer; font-size:1rem;
  }
  .popup-image-container .left { left:0; border-radius:0 8px 8px 0; }
  .popup-image-container .right { right:0; border-radius:8px 0 0 8px; }

  /* Buttons */
  .action-buttons {
    display:flex; flex-wrap:wrap;
    justify-content:center;
    gap:10px;
    margin:20px;
  }
  .action-buttons button {
    background:#7BBF42; color:white;
    padding:10px 16px;
    border:none; border-radius:8px;
    font-size:1rem;
    cursor:pointer;
    transition:background 0.3s;
  }
  .action-buttons button:hover {
    background:#0077b6;
  }

  /* Footer mit Pixel-Fahrradfahrern */
  

/* Wolken */
.cloud {
  position: absolute;
  top: 20px;
  background-repeat: no-repeat;
  background-size: contain;
  image-rendering: pixelated;
  opacity: 0.9;
  animation: cloud-move linear infinite;
}
@keyframes cloud-move {
  from { left: -200px; }
  to { left: 110%; }
}

/* Footer mit Wiese */
footer {
  position: relative;
  background: url('wiese (1).png') repeat-x bottom;
  background-size: contain;
  image-rendering: pixelated;
  padding: 40px 10px 100px;
  text-align: center;
  overflow: hidden;
}

/* Radfahrer */
.rider {
  position: absolute;
  bottom: 20px;
  width: 60px;
  height: 60px;
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center;
  image-rendering: pixelated;
  animation: ride linear infinite;
  pointer-events: none; /* verhindert Klicks auf die Radler */
}
@keyframes ride {
  from { left: -100px; }
  to { left: 110%; }
}
</style>
</head>
<body>

<header>
  <h1>RadlMap</h1>
  <p>Fahrrad App f√ºr Eierh√ºtten/Hofl√§den und Fahrradstopps</p>
</header>

<main>
  <h2>Unsere neuesten H√ºtten</h2>
  <div class="huts-container" id="huts-container"></div>

  <h2>Instagram News</h2>
<div id="instagram" style="text-align:center; margin:20px 0;">
  <a href="https://www.instagram.com/radlmap?igsh=MWszeHhkbGtwMjd3aw==" 
     target="_blank" 
     style="display:inline-block; text-decoration:none; color:#fff; background:#E4405F; padding:10px 20px; border-radius:8px; font-weight:bold; font-size:1.1rem;">
    üì∑ Folge uns auf Instagram
  </a>
</div>
</main>

<!-- Popup -->
<div id="hut-popup">
  <div id="hut-popup-content">
    <span id="hut-popup-close">&times;</span>
    <h3 id="popup-name"></h3>
    <div class="popup-image-container" id="popup-images"></div>
    <div id="popup-map" style="height:200px; border-radius:1rem; margin-bottom:1rem;"></div>
    <p><b>√ñffnungszeiten:</b> <span id="popup-oeffnungszeiten"></span></p>
    <p><b>Strom:</b> <span id="popup-strom"></span></p>
    <p><b>Sitzpl√§tze:</b> <span id="popup-sitzplaetze"></span></p>
    <p><b>Extras:</b> <span id="popup-extras"></span></p>
    <p><b>Start:</b> <span id="popup-start"></span></p>
  </div>
</div>

<footer>
  ¬© 2025 RadlMap | Mit dem Fahrrad die Region entdecken
  <div class="rider" style="animation-delay:0s"></div>
  <div class="rider" style="animation-delay:5s"></div>
  <div class="rider" style="animation-delay:10s"></div>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAu39z49KEJy9zso-etFIScmaFnWw8vhro",
  authDomain: "eierhuettentour.firebaseapp.com",
  projectId: "eierhuettentour",
  storageBucket: "eierhuettentour.appspot.com", // korrigiert
  messagingSenderId: "348272135205",
  appId: "1:348272135205:web:f39a7d26d927fbf28dc3cc",
  measurementId: "G-16V6K5GXDT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Slideshow
function renderSlideshow(container, bilderUrls) {
  if (!bilderUrls || bilderUrls.length === 0) {
    container.innerHTML = `<div style="height:140px; background:#ccc; display:flex; 
      align-items:center; justify-content:center; border-radius:8px;">Kein Bild</div>`;
    return;
  }
  let index = 0;
  function updateImage() {
    container.innerHTML = `
      <img src="${bilderUrls[index]}" alt="H√ºttenbild">
      ${bilderUrls.length > 1 ? `
        <button class="left">‚Üê</button>
        <button class="right">‚Üí</button>
      ` : ""}
    `;
    if (bilderUrls.length > 1) {
      container.querySelector(".left").onclick = () => { index = (index - 1 + bilderUrls.length) % bilderUrls.length; updateImage(); };
      container.querySelector(".right").onclick = () => { index = (index + 1) % bilderUrls.length; updateImage(); };
    }
  }
  updateImage();
}
/* Wolken erstellen */
const cloudShapes = [
  "cloud1.png",
  "cloud2.png",
  "cloud3.png"
];
for (let i = 0; i < 6; i++) {
  const cloud = document.createElement("div");
  cloud.className = "cloud";
  cloud.style.top = Math.random() * 120 + "px";
  cloud.style.width = 80 + Math.random() * 120 + "px";
  cloud.style.height = "auto";
  cloud.style.backgroundImage = `url(${cloudShapes[Math.floor(Math.random()*cloudShapes.length)]})`;
  cloud.style.animationDuration = 30 + Math.random()*40 + "s";
  cloud.style.animationDelay = (-Math.random()*40) + "s";
  document.querySelector("header").appendChild(cloud);
}

/* Radfahrer erstellen */
const riderSprites = [
  "radler1.png",
  "radler2.png",
  "radler3.png"
];
for (let i = 0; i < 4; i++) {
  const rider = document.createElement("div");
  rider.className = "rider";
  const size = 40 + Math.random()*40;
  rider.style.width = size + "px";
  rider.style.height = size + "px";
  rider.style.backgroundImage = `url(${riderSprites[Math.floor(Math.random()*riderSprites.length)]})`;
  rider.style.animationDuration = 12 + Math.random()*10 + "s";
  rider.style.animationDelay = (-Math.random()*15) + "s";
  document.querySelector("footer").appendChild(rider);
    }
// Popup
function openHutPopup(d, bilderUrls) {
  const popup = document.getElementById("hut-popup");
  const content = document.getElementById("hut-popup-content");
  popup.style.display = "flex";
  setTimeout(() => { content.style.transform = "translateY(0)"; }, 50);

  document.getElementById("popup-name").textContent = d.name || "Unbenannt";
  document.getElementById("popup-oeffnungszeiten").textContent = d.oeffnungszeiten || "-";
  document.getElementById("popup-strom").textContent = d.strom === "Ja" ? "‚úÖ Ja" : "‚ùå Nein";
  document.getElementById("popup-sitzplaetze").textContent = d.sitzplaetze === "Ja" ? "‚úÖ Ja" : "‚ùå Nein";
  document.getElementById("popup-extras").textContent = d.extras || "‚Äì";
  document.getElementById("popup-start").textContent = d.aboStart?.toDate?.().toLocaleDateString("de-DE") || "-";

  renderSlideshow(document.getElementById("popup-images"), bilderUrls);
}
function closeHutPopup() {
  const popup = document.getElementById("hut-popup");
  const content = document.getElementById("hut-popup-content");
  content.style.transform = "translateY(100%)";
  setTimeout(() => { popup.style.display = "none"; }, 400);
}
document.getElementById("hut-popup-close").onclick = closeHutPopup;
document.getElementById("hut-popup").onclick = e => {
  if (e.target.id === "hut-popup") closeHutPopup();
};

// H√ºtten laden (3 neueste)
const container = document.getElementById("huts-container");
db.collection("eierhuetten")
  .orderBy("aboStart","desc")
  .limit(3)
  .onSnapshot(snap => {
    container.innerHTML = "";
    let index = 1;
    snap.forEach(doc => {
      const d = doc.data();
      if (!d.location || d.status != "angenommen") return;

      const freigegebeneBilder = Array.isArray(d.fotos)
        ? d.fotos.filter(f => typeof f === 'string' || f.status === 'freigegeben')
        : [];
      const bilderUrls = freigegebeneBilder.map(f =>
        typeof f === 'string' ? f : f.url
      );
      const erstesBild = bilderUrls[0] || "https://via.placeholder.com/320x180?text=Keine+Fotos";

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${erstesBild}" style="width:100%; height:180px; object-fit:cover;">
        <div class="info">
          <h3>${index}. ${d.name || "Unbenannt"}</h3>
          <div class="details">
            <span><b>√ñffnungszeiten:</b> ${d.oeffnungszeiten || "-"}</span>
            <span><b>Strom:</b> ${d.strom === "Ja" ? "‚ö° Ja" : "‚ùå Nein"}</span>
            <span><b>Sitzpl√§tze:</b> ${d.sitzplaetze === "Ja" ? "‚úÖ Ja" : "‚ùå Nein"}</span>
            <span><b>Extras:</b> ${d.extras || "‚Äì"}</span>
            <span><b>Start:</b> ${d.aboStart?.toDate?.().toLocaleDateString("de-DE") || "-"}</span>
          </div>
        </div>
      `;
      card.onclick = () => openHutPopup(d, bilderUrls);
      container.appendChild(card);
      index++;
    });
  });

// Buttons
const actionDiv = document.createElement("div");
actionDiv.className = "action-buttons";
actionDiv.innerHTML = `
  <button onclick="location.href='https://radlmap.de'">üö≤ Zur RadlMap</button>
  <button onclick="location.href='neue-huette.html'">‚ûï Neue H√ºtte eintragen</button>
  <button onclick="location.href='https://kickstarter.com/'">üíö Uns auf KICKSTARTER unterst√ºtzen</button>
`;
document.querySelector("main").appendChild(actionDiv);
</script>
</body>
</html>
